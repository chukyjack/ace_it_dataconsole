/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Inject, QueryList, ContentChild, ContentChildren, Optional, forwardRef } from '@angular/core';
import { takeUntil, take } from 'rxjs/operators';
import { IgxForOfDirective } from '../directives/for-of/for_of.directive';
import { IGX_COMBO_COMPONENT } from './combo.common';
import { Navigate } from '../drop-down/drop-down.common';
import { IGX_DROPDOWN_BASE } from '../drop-down/drop-down.common';
import { IgxDropDownComponent } from '../drop-down/drop-down.component';
import { DropDownActionKey } from '../drop-down/drop-down.common';
import { IgxComboAddItemComponent } from './combo-add-item.component';
import { IgxComboAPIService } from './combo.api';
import { IgxSelectionAPIService } from '../core/selection';
import { IgxComboItemComponent } from './combo-item.component';
import { DisplayDensityToken } from '../core/density';
/**
 * @hidden
 */
var IgxComboDropDownComponent = /** @class */ (function (_super) {
    tslib_1.__extends(IgxComboDropDownComponent, _super);
    function IgxComboDropDownComponent(elementRef, cdr, selection, combo, comboAPI, _displayDensityOptions) {
        var _this = _super.call(this, elementRef, cdr, selection, _displayDensityOptions) || this;
        _this.elementRef = elementRef;
        _this.cdr = cdr;
        _this.selection = selection;
        _this.combo = combo;
        _this.comboAPI = comboAPI;
        _this._displayDensityOptions = _displayDensityOptions;
        _this._scrollPosition = 0;
        /**
         * @hidden
         * \@internal
         */
        _this.children = null;
        _this.scrollHandler = function () {
            _this.comboAPI.disableTransitions = true;
        };
        return _this;
    }
    Object.defineProperty(IgxComboDropDownComponent.prototype, "scrollContainer", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            return this.verticalScrollContainer.dc.location.nativeElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxComboDropDownComponent.prototype, "isScrolledToLast", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            /** @type {?} */
            var scrollTop = this.verticalScrollContainer.getVerticalScroll().scrollTop;
            /** @type {?} */
            var scrollHeight = this.verticalScrollContainer.getVerticalScroll().scrollHeight;
            return Math.floor(scrollTop + this.verticalScrollContainer.igxForContainerSize) === scrollHeight;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxComboDropDownComponent.prototype, "lastVisibleIndex", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            return this.combo.totalItemCount ?
                Math.floor(this.combo.itemsMaxHeight / this.combo.itemHeight) :
                this.items.length - 1;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.onFocus = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        this._focusedItem = this._focusedItem || this.items[0];
        if (this._focusedItem) {
            this._focusedItem.focused = true;
        }
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @param {?=} evt
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.onBlur = /**
     * @hidden \@internal
     * @param {?=} evt
     * @return {?}
     */
    function (evt) {
        if (this._focusedItem) {
            this._focusedItem.focused = false;
            this._focusedItem = null;
        }
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.onToggleOpened = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        this.onOpened.emit();
    };
    /**
     * @hidden
     */
    /**
     * @hidden
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigatePrev = /**
     * @hidden
     * @return {?}
     */
    function () {
        if (this._focusedItem.itemIndex === 0 && this.verticalScrollContainer.state.startIndex === 0) {
            this.combo.focusSearchInput(false);
        }
        else {
            _super.prototype.navigatePrev.call(this);
        }
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigateFirst = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        if (vContainer.state.startIndex === 0) {
            _super.prototype.navigateItem.call(this, 0);
            return;
        }
        vContainer.scrollTo(0);
        this.subscribeNext(vContainer, function () {
            _this.combo.triggerCheck();
            _super.prototype.navigateItem.call(_this, 0);
            _this.combo.triggerCheck();
        });
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigateLast = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        /** @type {?} */
        var scrollTarget = this.combo.totalItemCount ?
            this.combo.totalItemCount - 1 :
            Math.max(this.combo.data.length - 1, vContainer.igxForOf.length - 1);
        if (vContainer.igxForOf.length <= vContainer.state.startIndex + vContainer.state.chunkSize) {
            _super.prototype.navigateItem.call(this, this.items.length - 1);
            return;
        }
        vContainer.scrollTo(scrollTarget);
        this.subscribeNext(vContainer, function () {
            _this.combo.triggerCheck();
            _super.prototype.navigateItem.call(_this, _this.items.length - 1);
            _this.combo.triggerCheck();
        });
    };
    /**
     * @private
     * @param {?} direction
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigateRemoteItem = /**
     * @private
     * @param {?} direction
     * @return {?}
     */
    function (direction) {
        var _this = this;
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        vContainer.addScrollTop(direction * this.combo.itemHeight);
        this.subscribeNext(vContainer, function () {
            if (direction === Navigate.Up) {
                _super.prototype.navigateItem.call(_this, 0);
            }
            else {
                _super.prototype.navigateItem.call(_this, _this.focusedItem.itemIndex);
            }
        });
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @param {?} item
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.selectItem = /**
     * @hidden \@internal
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (item === null || item === undefined) {
            return;
        }
        this.comboAPI.set_selected_item(item.itemID);
        this._focusedItem = item;
    };
    /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigateDown = /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    function (newIndex) {
        var _this = this;
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        /** @type {?} */
        var allData = vContainer.igxForOf;
        /** @type {?} */
        var extraScroll = this.combo.isAddButtonVisible() ? 1 : 0;
        /** @type {?} */
        var focusedItem = this.focusedItem;
        /** @type {?} */
        var items = this.items;
        /** @type {?} */
        var children = this.sortedChildren;
        if (focusedItem) {
            if (this.isAddItemFocused()) {
                return;
            }
            if (focusedItem.value === allData[allData.length - 1]) {
                this.focusAddItemButton();
                return;
            }
        }
        /** @type {?} */
        var targetDataIndex = newIndex === -1 ? this.itemIndexInData(this.focusedItem.itemIndex) + 1 : this.itemIndexInData(newIndex);
        /** @type {?} */
        var lastLoadedIndex = vContainer.state.startIndex + vContainer.state.chunkSize - 1;
        if (targetDataIndex < lastLoadedIndex) { // If no scroll is required
            if (newIndex !== -1 || newIndex === children.length - 1 - extraScroll) { // Use normal nav for visible items
                _super.prototype.navigateItem.call(this, newIndex);
            }
        }
        else if (this.isScrolledToLast && targetDataIndex === lastLoadedIndex) { // If already at bottom and target is last item
            _super.prototype.navigateItem.call(this, items.length - 1 - extraScroll); // Focus the last item (excluding Add Button)
        }
        else { // If scroll is required
            // If scroll is required
            // If item is header, find next non-header index
            /** @type {?} */
            var addedIndex_1 = allData[targetDataIndex].isHeader ? this.findNextFocusableItem(targetDataIndex, Navigate.Down, allData) : 0;
            targetDataIndex += addedIndex_1; // Add steps to the target index
            if (addedIndex_1 === -1) { // If there are no more non-header items & add button is visible
                this.focusAddItemButton();
            }
            else if (targetDataIndex === allData.length - 1 && !this.isScrolledToLast) {
                // If target is very last loaded item, but scroll is not at the bottom (item is in DOM but not visible)
                vContainer.scrollTo(targetDataIndex); // This will not trigger `onChunkLoad`
                _super.prototype.navigateItem.call(this, items.length - 1 - extraScroll); // Target last item (excluding Add Button)
            }
            else { // Perform virtual scroll
                this.subscribeNext(vContainer, function () {
                    // children = all items in the DD (including addItemButton)
                    // length - 2 instead of -1, because we do not want to focus the last loaded item (in DOM, but not visible)
                    // Focus last item (excluding Add Button)
                    _super.prototype.navigateItem.call(_this, !addedIndex_1 ? children[children.length - 1 - extraScroll].itemIndex : _this.items.length - 2);
                });
                vContainer.scrollTo(targetDataIndex); // Perform virtual scroll
            }
        }
    };
    /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigateUp = /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    function (newIndex) {
        var _this = this;
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        /** @type {?} */
        var allData = vContainer.igxForOf;
        /** @type {?} */
        var focusedItem = this.focusedItem;
        if (focusedItem.value === allData.find(function (e) { return !e.isHeader && !e.hidden; })) { // If this is the very first non-header item
            this.focusComboSearch(); // Focus combo search
            return;
        }
        /** @type {?} */
        var targetDataIndex = newIndex === -1 ? this.itemIndexInData(focusedItem.itemIndex) - 1 : this.itemIndexInData(newIndex);
        if (newIndex !== -1) { // If no scroll is required
            if (this.isScrolledToLast && targetDataIndex === vContainer.state.startIndex) {
                // If virt scrollbar is @ bottom, first item is in DOM but not visible
                vContainer.scrollTo(targetDataIndex); // This will not trigger `onChunkLoad`
                _super.prototype.navigateItem.call(this, 0); // Focus first visible item
            }
            else {
                _super.prototype.navigateItem.call(this, newIndex); // Use normal navigation
            }
        }
        else { // Perform virtual scroll
            // Perform virtual scroll
            // If item is header, find next non-header index
            /** @type {?} */
            var addedIndex = allData[targetDataIndex].isHeader ? this.findNextFocusableItem(targetDataIndex, Navigate.Up, allData) : 0;
            targetDataIndex -= addedIndex; // Add steps to targetDataIndex
            if (addedIndex === -1) { // If there is no non-header
                vContainer.scrollTo(0);
                this.focusComboSearch(); // Focus combo search;
            }
            else {
                this.subscribeNext(vContainer, function () {
                    _super.prototype.navigateItem.call(_this, 0); // Focus the first loaded item
                });
                vContainer.scrollTo(targetDataIndex); // Perform virtual scroll
            }
        }
    };
    /**
     * @protected
     * @param {?} direction
     * @param {?=} currentIndex
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.navigate = /**
     * @protected
     * @param {?} direction
     * @param {?=} currentIndex
     * @return {?}
     */
    function (direction, currentIndex) {
        /** @type {?} */
        var index = -1;
        if (this._focusedItem) {
            index = currentIndex ? currentIndex : this._focusedItem.itemIndex;
        }
        /** @type {?} */
        var newIndex = this.getNearestSiblingFocusableItemIndex(index, direction);
        /** @type {?} */
        var vContainer = this.verticalScrollContainer;
        /** @type {?} */
        var notVirtual = vContainer.dc.instance.notVirtual;
        if (notVirtual || !direction) { // If list has no scroll OR no direction is passed
            _super.prototype.navigateItem.call(this, newIndex); // use default scroll
        }
        else if (vContainer && vContainer.totalItemCount && vContainer.totalItemCount !== 0) { // Remote scroll
            if (newIndex !== -1 &&
                this.items[newIndex].isVisible(direction)) {
                this.navigateItem(newIndex);
            }
            else {
                this.navigateRemoteItem(direction);
            }
        }
        else {
            if (direction === Navigate.Up) { // Navigate UP
                this.navigateUp(newIndex);
            }
            else if (direction === Navigate.Down) { // Navigate DOWN
                this.navigateDown(newIndex);
            }
        }
    };
    /**
     * @private
     * @param {?} index
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.itemIndexInData = /**
     * @private
     * @param {?} index
     * @return {?}
     */
    function (index) {
        return this.sortedChildren.findIndex(function (e) { return e.itemIndex === index; }) + this.verticalScrollContainer.state.startIndex;
    };
    /**
     * @private
     * @param {?} indexInData
     * @param {?} direction
     * @param {?} data
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.findNextFocusableItem = /**
     * @private
     * @param {?} indexInData
     * @param {?} direction
     * @param {?} data
     * @return {?}
     */
    function (indexInData, direction, data) {
        if (direction === Navigate.Up) {
            return tslib_1.__spread(data).splice(0, indexInData + 1).reverse().findIndex(function (e) { return !e.isHeader; });
        }
        return tslib_1.__spread(data).splice(indexInData, data.length - 1).findIndex(function (e) { return !e.isHeader; });
    };
    /**
     * @private
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.focusComboSearch = /**
     * @private
     * @return {?}
     */
    function () {
        this.combo.focusSearchInput(false);
        if (this.focusedItem) {
            this.focusedItem.focused = false;
        }
        this.focusedItem = null;
    };
    /**
     * @private
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.focusAddItemButton = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.combo.isAddButtonVisible()) {
            _super.prototype.navigateItem.call(this, this.items.length - 1);
        }
    };
    /**
     * @private
     * @param {?} virtualContainer
     * @param {?} callback
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.subscribeNext = /**
     * @private
     * @param {?} virtualContainer
     * @param {?} callback
     * @return {?}
     */
    function (virtualContainer, callback) {
        virtualContainer.onChunkLoad.pipe(take(1), takeUntil(this.destroy$)).subscribe({
            next: function (e) {
                callback(e);
            }
        });
    };
    /**
     * @protected
     * @param {?} newItem
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.scrollToHiddenItem = /**
     * @protected
     * @param {?} newItem
     * @return {?}
     */
    function (newItem) { };
    Object.defineProperty(IgxComboDropDownComponent.prototype, "sortedChildren", {
        get: /**
         * @protected
         * @return {?}
         */
        function () {
            if (this.children !== undefined) {
                return this.children.toArray()
                    .sort(function (a, b) {
                    return a.index - b.index;
                });
            }
            return null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IgxComboDropDownComponent.prototype, "items", {
        /**
         * Get all non-header items
         *
         * ```typescript
         * let myDropDownItems = this.dropdown.items;
         * ```
         */
        get: /**
         * Get all non-header items
         *
         * ```typescript
         * let myDropDownItems = this.dropdown.items;
         * ```
         * @return {?}
         */
        function () {
            var e_1, _a;
            /** @type {?} */
            var items = [];
            if (this.children !== undefined) {
                /** @type {?} */
                var sortedChildren = (/** @type {?} */ (this.sortedChildren));
                try {
                    for (var sortedChildren_1 = tslib_1.__values(sortedChildren), sortedChildren_1_1 = sortedChildren_1.next(); !sortedChildren_1_1.done; sortedChildren_1_1 = sortedChildren_1.next()) {
                        var child = sortedChildren_1_1.value;
                        if (!child.isHeader) {
                            items.push(child);
                        }
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (sortedChildren_1_1 && !sortedChildren_1_1.done && (_a = sortedChildren_1.return)) _a.call(sortedChildren_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
            return items;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @protected
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.scrollToItem = /**
     * @protected
     * @return {?}
     */
    function () {
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @param {?} e
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.onToggleClosing = /**
     * @hidden \@internal
     * @param {?} e
     * @return {?}
     */
    function (e) {
        _super.prototype.onToggleClosing.call(this, e);
        this._scrollPosition = this.verticalScrollContainer.getVerticalScroll().scrollTop;
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.updateScrollPosition = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        this.verticalScrollContainer.getVerticalScroll().scrollTop = this._scrollPosition;
    };
    /**
     * @hidden @internal
     */
    /**
     * @hidden \@internal
     * @param {?} key
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.onItemActionKey = /**
     * @hidden \@internal
     * @param {?} key
     * @return {?}
     */
    function (key) {
        switch (key) {
            case DropDownActionKey.ENTER:
                this.handleEnter();
                break;
            case DropDownActionKey.SPACE:
                this.handleSpace();
                break;
            case DropDownActionKey.ESCAPE:
                this.close();
        }
    };
    /**
     * @private
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.handleEnter = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.isAddItemFocused()) {
            this.combo.addItemToCollection();
        }
        else {
            this.close();
        }
    };
    /**
     * @private
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.handleSpace = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.isAddItemFocused()) {
            return;
        }
        else {
            this.selectItem(this.focusedItem);
        }
    };
    /**
     * @private
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.isAddItemFocused = /**
     * @private
     * @return {?}
     */
    function () {
        return this.focusedItem instanceof IgxComboAddItemComponent;
    };
    /**
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.verticalScrollContainer.getVerticalScroll().addEventListener('scroll', this.scrollHandler);
    };
    /**
     *@hidden @internal
     */
    /**
     * @hidden \@internal
     * @return {?}
     */
    IgxComboDropDownComponent.prototype.ngOnDestroy = /**
     * @hidden \@internal
     * @return {?}
     */
    function () {
        this.verticalScrollContainer.getVerticalScroll().removeEventListener('scroll', this.scrollHandler);
        this.destroy$.next(true);
        this.destroy$.complete();
    };
    IgxComboDropDownComponent.decorators = [
        { type: Component, args: [{
                    selector: 'igx-combo-drop-down',
                    template: "<div class=\"igx-drop-down__list\" igxToggle [style.width]=\"width\" [style.height]=\"height\"\n[style.maxHeight]=\"maxHeight\" [attr.id]=\"this.listId\" role=\"listbox\"\n    (onOpening)=\"onToggleOpening($event)\" (onOpened)=\"onToggleOpened()\"\n    (onClosing)=\"onToggleClosing($event)\" (onClosed)=\"onToggleClosed()\">\n    <ng-container *ngIf=\"!collapsed\">\n        <ng-content></ng-content>\n    </ng-container>\n</div>\n",
                    providers: [{ provide: IGX_DROPDOWN_BASE, useExisting: IgxComboDropDownComponent }]
                }] }
    ];
    /** @nocollapse */
    IgxComboDropDownComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef },
        { type: IgxSelectionAPIService },
        { type: undefined, decorators: [{ type: Inject, args: [IGX_COMBO_COMPONENT,] }] },
        { type: IgxComboAPIService },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DisplayDensityToken,] }] }
    ]; };
    IgxComboDropDownComponent.propDecorators = {
        children: [{ type: ContentChildren, args: [IgxComboItemComponent, { descendants: true },] }],
        verticalScrollContainer: [{ type: ContentChild, args: [forwardRef(function () { return IgxForOfDirective; }), { read: IgxForOfDirective },] }]
    };
    return IgxComboDropDownComponent;
}(IgxDropDownComponent));
export { IgxComboDropDownComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    IgxComboDropDownComponent.prototype._scrollPosition;
    /**
     * @hidden
     * \@internal
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.children;
    /**
     * @hidden \@internal
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.verticalScrollContainer;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.scrollHandler;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.elementRef;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.cdr;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.selection;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.combo;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.comboAPI;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype._displayDensityOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vaWduaXRldWktYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb21iby9jb21iby1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0gsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUE0QixZQUFZLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFDOUgsVUFBVSxFQUNiLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFFMUUsT0FBTyxFQUFnQixtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUN6RCxPQUFPLEVBQWlCLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDakYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDeEUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDbEUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWpELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzNELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxtQkFBbUIsRUFBMEIsTUFBTSxpQkFBaUIsQ0FBQzs7OztBQUc5RTtJQUsrQyxxREFBb0I7SUFDL0QsbUNBQ2MsVUFBc0IsRUFDdEIsR0FBc0IsRUFDdEIsU0FB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ICAgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5qZWN0LCBRdWVyeUxpc3QsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCwgQ29udGVudENoaWxkLCBDb250ZW50Q2hpbGRyZW4sIE9wdGlvbmFsLFxuICAgIGZvcndhcmRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyB0YWtlVW50aWwsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJZ3hGb3JPZkRpcmVjdGl2ZSB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvZm9yLW9mL2Zvcl9vZi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQ2FuY2VsYWJsZUJyb3dzZXJFdmVudEFyZ3MgfSBmcm9tICcuLi9jb3JlL3V0aWxzJztcbmltcG9ydCB7IElneENvbWJvQmFzZSwgSUdYX0NPTUJPX0NPTVBPTkVOVCB9IGZyb20gJy4vY29tYm8uY29tbW9uJztcbmltcG9ydCB7IE5hdmlnYXRlIH0gZnJvbSAnLi4vZHJvcC1kb3duL2Ryb3AtZG93bi5jb21tb24nO1xuaW1wb3J0IHsgSURyb3BEb3duQmFzZSwgSUdYX0RST1BET1dOX0JBU0UgfSBmcm9tICcuLi9kcm9wLWRvd24vZHJvcC1kb3duLmNvbW1vbic7XG5pbXBvcnQgeyBJZ3hEcm9wRG93bkNvbXBvbmVudCB9IGZyb20gJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24uY29tcG9uZW50JztcbmltcG9ydCB7IERyb3BEb3duQWN0aW9uS2V5IH0gZnJvbSAnLi4vZHJvcC1kb3duL2Ryb3AtZG93bi5jb21tb24nO1xuaW1wb3J0IHsgSWd4Q29tYm9BZGRJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9jb21iby1hZGQtaXRlbS5jb21wb25lbnQnO1xuaW1wb3J0IHsgSWd4Q29tYm9BUElTZXJ2aWNlIH0gZnJvbSAnLi9jb21iby5hcGknO1xuaW1wb3J0IHsgSWd4RHJvcERvd25JdGVtQmFzZSB9IGZyb20gJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24taXRlbS5iYXNlJztcbmltcG9ydCB7IElneFNlbGVjdGlvbkFQSVNlcnZpY2UgfSBmcm9tICcuLi9jb3JlL3NlbGVjdGlvbic7XG5pbXBvcnQgeyBJZ3hDb21ib0l0ZW1Db21wb25lbnQgfSBmcm9tICcuL2NvbWJvLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IERpc3BsYXlEZW5zaXR5VG9rZW4sIElEaXNwbGF5RGVuc2l0eU9wdGlvbnMgfSBmcm9tICcuLi9jb3JlL2RlbnNpdHknO1xuXG4vKiogQGhpZGRlbiAqL1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdpZ3gtY29tYm8tZHJvcC1kb3duJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24uY29tcG9uZW50Lmh0bWwnLFxuICAgIHByb3ZpZGVyczogW3sgcHJvdmlkZTogSUdYX0RST1BET1dOX0JBU0UsIHVzZUV4aXN0aW5nOiBJZ3hDb21ib0Ryb3BEb3duQ29tcG9uZW50IH1dXG59KVxuZXhwb3J0IGNsYXNzIElneENvbWJvRHJvcERvd25Db21wb25lbnQgZXh0ZW5kcyBJZ3hEcm9wRG93bkNvbXBvbmVudCBpbXBsZW1lbnRzIElEcm9wRG93bkJhc2UsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByb3RlY3RlZCBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgICAgICBwcm90ZWN0ZWQgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgcHJvdGVjdGVkIHNlbGVjdGlvbjogSWd4U2VsZWN0aW9uQVBJU2VydmljZSxcbiAgICAgICAgQEluamVjdChJR1hfQ09NQk9fQ09NUE9ORU5UKSBwdWJsaWMgY29tYm86IElneENvbWJvQmFzZSxcbiAgICAgICAgcHJvdGVjdGVkIGNvbWJvQVBJOiBJZ3hDb21ib0FQSVNlcnZpY2UsXG4gICAgICAgIEBPcHRpb25hbCgpIEBJbmplY3QoRGlzcGxheURlbnNpdHlUb2tlbikgcHJvdGVjdGVkIF9kaXNwbGF5RGVuc2l0eU9wdGlvbnM6IElEaXNwbGF5RGVuc2l0eU9wdGlvbnMpIHtcbiAgICAgICAgc3VwZXIoZWxlbWVudFJlZiwgY2RyLCBzZWxlY3Rpb24sIF9kaXNwbGF5RGVuc2l0eU9wdGlvbnMpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgc2Nyb2xsQ29udGFpbmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5kYy5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaXNTY3JvbGxlZFRvTGFzdCgpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgc2Nyb2xsVG9wID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLnNjcm9sbFRvcDtcbiAgICAgICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLnNjcm9sbEhlaWdodDtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3Ioc2Nyb2xsVG9wICsgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5pZ3hGb3JDb250YWluZXJTaXplKSA9PT0gc2Nyb2xsSGVpZ2h0O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgbGFzdFZpc2libGVJbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21iby50b3RhbEl0ZW1Db3VudCA/XG4gICAgICAgICAgICBNYXRoLmZsb29yKHRoaXMuY29tYm8uaXRlbXNNYXhIZWlnaHQgLyB0aGlzLmNvbWJvLml0ZW1IZWlnaHQpIDpcbiAgICAgICAgICAgIHRoaXMuaXRlbXMubGVuZ3RoIC0gMTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9zY3JvbGxQb3NpdGlvbiA9IDA7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgQENvbnRlbnRDaGlsZHJlbihJZ3hDb21ib0l0ZW1Db21wb25lbnQsIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcbiAgICBwdWJsaWMgY2hpbGRyZW46IFF1ZXJ5TGlzdDxJZ3hEcm9wRG93bkl0ZW1CYXNlPiA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIEBDb250ZW50Q2hpbGQoZm9yd2FyZFJlZigoKSA9PiBJZ3hGb3JPZkRpcmVjdGl2ZSksIHsgcmVhZDogSWd4Rm9yT2ZEaXJlY3RpdmUgfSlcbiAgICBwdWJsaWMgdmVydGljYWxTY3JvbGxDb250YWluZXI6IElneEZvck9mRGlyZWN0aXZlPGFueT47XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBvbkZvY3VzKCkge1xuICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbSA9IHRoaXMuX2ZvY3VzZWRJdGVtIHx8IHRoaXMuaXRlbXNbMF07XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0uZm9jdXNlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBvbkJsdXIoZXZ0Pykge1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzZWRJdGVtLmZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzZWRJdGVtID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW4gQGludGVybmFsXG4gICAgICovXG4gICAgcHVibGljIG9uVG9nZ2xlT3BlbmVkKCkge1xuICAgICAgICB0aGlzLm9uT3BlbmVkLmVtaXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHB1YmxpYyBuYXZpZ2F0ZVByZXYoKSB7XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c2VkSXRlbS5pdGVtSW5kZXggPT09IDAgJiYgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLmZvY3VzU2VhcmNoSW5wdXQoZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVQcmV2KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBuYXZpZ2F0ZUZpcnN0KCkge1xuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgaWYgKHZDb250YWluZXIuc3RhdGUuc3RhcnRJbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKDApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8oMCk7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTmV4dCh2Q29udGFpbmVyLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnRyaWdnZXJDaGVjaygpO1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKDApO1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgbmF2aWdhdGVMYXN0KCkge1xuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgY29uc3Qgc2Nyb2xsVGFyZ2V0ID0gdGhpcy5jb21iby50b3RhbEl0ZW1Db3VudCA/XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnRvdGFsSXRlbUNvdW50IC0gMSA6XG4gICAgICAgICAgICBNYXRoLm1heCh0aGlzLmNvbWJvLmRhdGEubGVuZ3RoIC0gMSwgdkNvbnRhaW5lci5pZ3hGb3JPZi5sZW5ndGggLSAxKTtcbiAgICAgICAgaWYgKHZDb250YWluZXIuaWd4Rm9yT2YubGVuZ3RoIDw9IHZDb250YWluZXIuc3RhdGUuc3RhcnRJbmRleCArIHZDb250YWluZXIuc3RhdGUuY2h1bmtTaXplKSB7XG4gICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0odGhpcy5pdGVtcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKHNjcm9sbFRhcmdldCk7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlTmV4dCh2Q29udGFpbmVyLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnRyaWdnZXJDaGVjaygpO1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKHRoaXMuaXRlbXMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICB0aGlzLmNvbWJvLnRyaWdnZXJDaGVjaygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG5hdmlnYXRlUmVtb3RlSXRlbShkaXJlY3Rpb246IE5hdmlnYXRlKSB7XG4gICAgICAgIGNvbnN0IHZDb250YWluZXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyO1xuICAgICAgICB2Q29udGFpbmVyLmFkZFNjcm9sbFRvcChkaXJlY3Rpb24gKiB0aGlzLmNvbWJvLml0ZW1IZWlnaHQpO1xuICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuVXApIHtcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0oMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSh0aGlzLmZvY3VzZWRJdGVtLml0ZW1JbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW4gQGludGVybmFsXG4gICAgICovXG4gICAgcHVibGljIHNlbGVjdEl0ZW0oaXRlbTogSWd4RHJvcERvd25JdGVtQmFzZSkge1xuICAgICAgICBpZiAoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbWJvQVBJLnNldF9zZWxlY3RlZF9pdGVtKGl0ZW0uaXRlbUlEKTtcbiAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0gPSBpdGVtO1xuICAgIH1cblxuICAgIHByaXZhdGUgbmF2aWdhdGVEb3duKG5ld0luZGV4PzogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHZDb250YWluZXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyO1xuICAgICAgICBjb25zdCBhbGxEYXRhID0gdkNvbnRhaW5lci5pZ3hGb3JPZjtcbiAgICAgICAgY29uc3QgZXh0cmFTY3JvbGwgPSB0aGlzLmNvbWJvLmlzQWRkQnV0dG9uVmlzaWJsZSgpID8gMSA6IDA7XG4gICAgICAgIGNvbnN0IGZvY3VzZWRJdGVtID0gdGhpcy5mb2N1c2VkSXRlbTtcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLml0ZW1zO1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuc29ydGVkQ2hpbGRyZW47XG4gICAgICAgIGlmIChmb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNBZGRJdGVtRm9jdXNlZCgpKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgaWYgKGZvY3VzZWRJdGVtLnZhbHVlID09PSBhbGxEYXRhW2FsbERhdGEubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzQWRkSXRlbUJ1dHRvbigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0RGF0YUluZGV4ID0gbmV3SW5kZXggPT09IC0xID8gdGhpcy5pdGVtSW5kZXhJbkRhdGEodGhpcy5mb2N1c2VkSXRlbS5pdGVtSW5kZXgpICsgMSA6IHRoaXMuaXRlbUluZGV4SW5EYXRhKG5ld0luZGV4KTtcbiAgICAgICAgY29uc3QgbGFzdExvYWRlZEluZGV4ID0gdkNvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4ICsgdkNvbnRhaW5lci5zdGF0ZS5jaHVua1NpemUgLSAxOyAvLyBMYXN0IGl0ZW0gaXMgbm90IHZpc2libGUsIHNvIHJlcXVpcmUgc2Nyb2xsXG4gICAgICAgIGlmICh0YXJnZXREYXRhSW5kZXggPCBsYXN0TG9hZGVkSW5kZXgpIHsgLy8gSWYgbm8gc2Nyb2xsIGlzIHJlcXVpcmVkXG4gICAgICAgICAgICBpZiAobmV3SW5kZXggIT09IC0xIHx8IG5ld0luZGV4ID09PSBjaGlsZHJlbi5sZW5ndGggLSAxIC0gZXh0cmFTY3JvbGwpIHsgLy8gVXNlIG5vcm1hbCBuYXYgZm9yIHZpc2libGUgaXRlbXNcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0obmV3SW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNTY3JvbGxlZFRvTGFzdCAmJiB0YXJnZXREYXRhSW5kZXggPT09IGxhc3RMb2FkZWRJbmRleCkgeyAvLyBJZiBhbHJlYWR5IGF0IGJvdHRvbSBhbmQgdGFyZ2V0IGlzIGxhc3QgaXRlbVxuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKGl0ZW1zLmxlbmd0aCAtIDEgLSBleHRyYVNjcm9sbCk7IC8vIEZvY3VzIHRoZSBsYXN0IGl0ZW0gKGV4Y2x1ZGluZyBBZGQgQnV0dG9uKVxuICAgICAgICB9IGVsc2UgeyAvLyBJZiBzY3JvbGwgaXMgcmVxdWlyZWRcbiAgICAgICAgICAgIC8vIElmIGl0ZW0gaXMgaGVhZGVyLCBmaW5kIG5leHQgbm9uLWhlYWRlciBpbmRleFxuICAgICAgICAgICAgY29uc3QgYWRkZWRJbmRleCA9IGFsbERhdGFbdGFyZ2V0RGF0YUluZGV4XS5pc0hlYWRlciA/IHRoaXMuZmluZE5leHRGb2N1c2FibGVJdGVtKHRhcmdldERhdGFJbmRleCwgTmF2aWdhdGUuRG93biwgYWxsRGF0YSkgOiAwO1xuICAgICAgICAgICAgdGFyZ2V0RGF0YUluZGV4ICs9IGFkZGVkSW5kZXg7IC8vIEFkZCBzdGVwcyB0byB0aGUgdGFyZ2V0IGluZGV4XG4gICAgICAgICAgICBpZiAoYWRkZWRJbmRleCA9PT0gLTEpIHsgLy8gSWYgdGhlcmUgYXJlIG5vIG1vcmUgbm9uLWhlYWRlciBpdGVtcyAmIGFkZCBidXR0b24gaXMgdmlzaWJsZVxuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNBZGRJdGVtQnV0dG9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldERhdGFJbmRleCA9PT0gYWxsRGF0YS5sZW5ndGggLSAxICYmICF0aGlzLmlzU2Nyb2xsZWRUb0xhc3QpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0YXJnZXQgaXMgdmVyeSBsYXN0IGxvYWRlZCBpdGVtLCBidXQgc2Nyb2xsIGlzIG5vdCBhdCB0aGUgYm90dG9tIChpdGVtIGlzIGluIERPTSBidXQgbm90IHZpc2libGUpXG4gICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyh0YXJnZXREYXRhSW5kZXgpOyAvLyBUaGlzIHdpbGwgbm90IHRyaWdnZXIgYG9uQ2h1bmtMb2FkYFxuICAgICAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbShpdGVtcy5sZW5ndGggLSAxIC0gZXh0cmFTY3JvbGwpOyAvLyBUYXJnZXQgbGFzdCBpdGVtIChleGNsdWRpbmcgQWRkIEJ1dHRvbilcbiAgICAgICAgICAgIH0gZWxzZSB7IC8vIFBlcmZvcm0gdmlydHVhbCBzY3JvbGxcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbiA9IGFsbCBpdGVtcyBpbiB0aGUgREQgKGluY2x1ZGluZyBhZGRJdGVtQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICAvLyBsZW5ndGggLSAyIGluc3RlYWQgb2YgLTEsIGJlY2F1c2Ugd2UgZG8gbm90IHdhbnQgdG8gZm9jdXMgdGhlIGxhc3QgbG9hZGVkIGl0ZW0gKGluIERPTSwgYnV0IG5vdCB2aXNpYmxlKVxuICAgICAgICAgICAgICAgICAgICAvLyBGb2N1cyBsYXN0IGl0ZW0gKGV4Y2x1ZGluZyBBZGQgQnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0oIWFkZGVkSW5kZXggPyBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxIC0gZXh0cmFTY3JvbGxdLml0ZW1JbmRleCA6IHRoaXMuaXRlbXMubGVuZ3RoIC0gMik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyh0YXJnZXREYXRhSW5kZXgpOyAvLyBQZXJmb3JtIHZpcnR1YWwgc2Nyb2xsXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIG5hdmlnYXRlVXAobmV3SW5kZXg/OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgdkNvbnRhaW5lciA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXI7XG4gICAgICAgIGNvbnN0IGFsbERhdGEgPSB2Q29udGFpbmVyLmlneEZvck9mO1xuICAgICAgICBjb25zdCBmb2N1c2VkSXRlbSA9IHRoaXMuZm9jdXNlZEl0ZW07XG4gICAgICAgIGlmIChmb2N1c2VkSXRlbS52YWx1ZSA9PT0gYWxsRGF0YS5maW5kKGUgPT4gIWUuaXNIZWFkZXIgJiYgIWUuaGlkZGVuKSkgeyAvLyBJZiB0aGlzIGlzIHRoZSB2ZXJ5IGZpcnN0IG5vbi1oZWFkZXIgaXRlbVxuICAgICAgICAgICAgdGhpcy5mb2N1c0NvbWJvU2VhcmNoKCk7IC8vIEZvY3VzIGNvbWJvIHNlYXJjaFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YXJnZXREYXRhSW5kZXggPSBuZXdJbmRleCA9PT0gLTEgPyB0aGlzLml0ZW1JbmRleEluRGF0YShmb2N1c2VkSXRlbS5pdGVtSW5kZXgpIC0gMSA6IHRoaXMuaXRlbUluZGV4SW5EYXRhKG5ld0luZGV4KTtcbiAgICAgICAgaWYgKG5ld0luZGV4ICE9PSAtMSkgeyAvLyBJZiBubyBzY3JvbGwgaXMgcmVxdWlyZWRcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU2Nyb2xsZWRUb0xhc3QgJiYgdGFyZ2V0RGF0YUluZGV4ID09PSB2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB2aXJ0IHNjcm9sbGJhciBpcyBAIGJvdHRvbSwgZmlyc3QgaXRlbSBpcyBpbiBET00gYnV0IG5vdCB2aXNpYmxlXG4gICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyh0YXJnZXREYXRhSW5kZXgpOyAvLyBUaGlzIHdpbGwgbm90IHRyaWdnZXIgYG9uQ2h1bmtMb2FkYFxuICAgICAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSgwKTsgLy8gRm9jdXMgZmlyc3QgdmlzaWJsZSBpdGVtXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbShuZXdJbmRleCk7IC8vIFVzZSBub3JtYWwgbmF2aWdhdGlvblxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgeyAvLyBQZXJmb3JtIHZpcnR1YWwgc2Nyb2xsXG4gICAgICAgICAgICAvLyBJZiBpdGVtIGlzIGhlYWRlciwgZmluZCBuZXh0IG5vbi1oZWFkZXIgaW5kZXhcbiAgICAgICAgICAgIGNvbnN0IGFkZGVkSW5kZXggPSBhbGxEYXRhW3RhcmdldERhdGFJbmRleF0uaXNIZWFkZXIgPyB0aGlzLmZpbmROZXh0Rm9jdXNhYmxlSXRlbSh0YXJnZXREYXRhSW5kZXgsIE5hdmlnYXRlLlVwLCBhbGxEYXRhKSA6IDA7XG4gICAgICAgICAgICB0YXJnZXREYXRhSW5kZXggLT0gYWRkZWRJbmRleDsgLy8gQWRkIHN0ZXBzIHRvIHRhcmdldERhdGFJbmRleFxuICAgICAgICAgICAgaWYgKGFkZGVkSW5kZXggPT09IC0xKSB7IC8vIElmIHRoZXJlIGlzIG5vIG5vbi1oZWFkZXJcbiAgICAgICAgICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKDApO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNDb21ib1NlYXJjaCgpOyAvLyBGb2N1cyBjb21ibyBzZWFyY2g7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlTmV4dCh2Q29udGFpbmVyLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSgwKTsgLy8gRm9jdXMgdGhlIGZpcnN0IGxvYWRlZCBpdGVtXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyh0YXJnZXREYXRhSW5kZXgpOyAvLyBQZXJmb3JtIHZpcnR1YWwgc2Nyb2xsXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbmF2aWdhdGUoZGlyZWN0aW9uOiBOYXZpZ2F0ZSwgY3VycmVudEluZGV4PzogbnVtYmVyKSB7XG4gICAgICAgIGxldCBpbmRleCA9IC0xO1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEl0ZW0pIHtcbiAgICAgICAgICAgIGluZGV4ID0gY3VycmVudEluZGV4ID8gY3VycmVudEluZGV4IDogdGhpcy5fZm9jdXNlZEl0ZW0uaXRlbUluZGV4O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5nZXROZWFyZXN0U2libGluZ0ZvY3VzYWJsZUl0ZW1JbmRleChpbmRleCwgZGlyZWN0aW9uKTtcbiAgICAgICAgY29uc3QgdkNvbnRhaW5lciA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXI7XG4gICAgICAgIGNvbnN0IG5vdFZpcnR1YWwgPSB2Q29udGFpbmVyLmRjLmluc3RhbmNlLm5vdFZpcnR1YWw7XG4gICAgICAgIGlmIChub3RWaXJ0dWFsIHx8ICFkaXJlY3Rpb24pIHsgLy8gSWYgbGlzdCBoYXMgbm8gc2Nyb2xsIE9SIG5vIGRpcmVjdGlvbiBpcyBwYXNzZWRcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbShuZXdJbmRleCk7IC8vIHVzZSBkZWZhdWx0IHNjcm9sbFxuICAgICAgICB9IGVsc2UgaWYgKHZDb250YWluZXIgJiYgdkNvbnRhaW5lci50b3RhbEl0ZW1Db3VudCAmJiB2Q29udGFpbmVyLnRvdGFsSXRlbUNvdW50ICE9PSAwKSB7IC8vIFJlbW90ZSBzY3JvbGxcbiAgICAgICAgICAgIGlmIChuZXdJbmRleCAhPT0gLTEgJiZcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zW25ld0luZGV4XS5pc1Zpc2libGUoZGlyZWN0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVJdGVtKG5ld0luZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVJlbW90ZUl0ZW0oZGlyZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IE5hdmlnYXRlLlVwKSB7IC8vIE5hdmlnYXRlIFVQXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZVVwKG5ld0luZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBOYXZpZ2F0ZS5Eb3duKSB7IC8vIE5hdmlnYXRlIERPV05cbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlRG93bihuZXdJbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGl0ZW1JbmRleEluRGF0YShpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZENoaWxkcmVuLmZpbmRJbmRleChlID0+IGUuaXRlbUluZGV4ID09PSBpbmRleCkgKyB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXg7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaW5kTmV4dEZvY3VzYWJsZUl0ZW0oaW5kZXhJbkRhdGE6IG51bWJlciwgZGlyZWN0aW9uOiBOYXZpZ2F0ZSwgZGF0YTogYW55W10pOiBudW1iZXIge1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBOYXZpZ2F0ZS5VcCkge1xuICAgICAgICAgICAgcmV0dXJuIFsuLi5kYXRhXS5zcGxpY2UoMCwgaW5kZXhJbkRhdGEgKyAxKS5yZXZlcnNlKCkuZmluZEluZGV4KGUgPT4gIWUuaXNIZWFkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbLi4uZGF0YV0uc3BsaWNlKGluZGV4SW5EYXRhLCBkYXRhLmxlbmd0aCAtIDEpLmZpbmRJbmRleChlID0+ICFlLmlzSGVhZGVyKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzQ29tYm9TZWFyY2goKSB7XG4gICAgICAgIHRoaXMuY29tYm8uZm9jdXNTZWFyY2hJbnB1dChmYWxzZSk7XG4gICAgICAgIGlmICh0aGlzLmZvY3VzZWRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzZWRJdGVtLmZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZvY3VzZWRJdGVtID0gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZvY3VzQWRkSXRlbUJ1dHRvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuY29tYm8uaXNBZGRCdXR0b25WaXNpYmxlKCkpIHtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSh0aGlzLml0ZW1zLmxlbmd0aCAtIDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVOZXh0KHZpcnR1YWxDb250YWluZXI6IGFueSwgY2FsbGJhY2s6IChlbGVtPykgPT4gdm9pZCkge1xuICAgICAgICB2aXJ0dWFsQ29udGFpbmVyLm9uQ2h1bmtMb2FkLnBpcGUodGFrZSgxKSwgdGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgbmV4dDogKGU6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2Nyb2xsVG9IaWRkZW5JdGVtKG5ld0l0ZW06IGFueSk6IHZvaWQgeyB9XG5cbiAgICBwcm90ZWN0ZWQgc2Nyb2xsSGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5jb21ib0FQSS5kaXNhYmxlVHJhbnNpdGlvbnMgPSB0cnVlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgc29ydGVkQ2hpbGRyZW4oKTogSWd4RHJvcERvd25JdGVtQmFzZVtdIHtcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4udG9BcnJheSgpXG4gICAgICAgICAgICAgICAgLnNvcnQoKGE6IElneERyb3BEb3duSXRlbUJhc2UsIGI6IElneERyb3BEb3duSXRlbUJhc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuaW5kZXggLSBiLmluZGV4O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgbm9uLWhlYWRlciBpdGVtc1xuICAgICAqXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGxldCBteURyb3BEb3duSXRlbXMgPSB0aGlzLmRyb3Bkb3duLml0ZW1zO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaXRlbXMoKTogSWd4Q29tYm9JdGVtQ29tcG9uZW50W10ge1xuICAgICAgICBjb25zdCBpdGVtczogSWd4Q29tYm9JdGVtQ29tcG9uZW50W10gPSBbXTtcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3Qgc29ydGVkQ2hpbGRyZW4gPSB0aGlzLnNvcnRlZENoaWxkcmVuIGFzIElneENvbWJvSXRlbUNvbXBvbmVudFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBzb3J0ZWRDaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGlmICghY2hpbGQuaXNIZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzY3JvbGxUb0l0ZW0oKSB7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW4gQGludGVybmFsXG4gICAgICovXG4gICAgb25Ub2dnbGVDbG9zaW5nKGU6IENhbmNlbGFibGVCcm93c2VyRXZlbnRBcmdzKSB7XG4gICAgICAgIHN1cGVyLm9uVG9nZ2xlQ2xvc2luZyhlKTtcbiAgICAgICAgdGhpcy5fc2Nyb2xsUG9zaXRpb24gPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLmdldFZlcnRpY2FsU2Nyb2xsKCkuc2Nyb2xsVG9wO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW4gQGludGVybmFsXG4gICAgICovXG4gICAgdXBkYXRlU2Nyb2xsUG9zaXRpb24oKSB7XG4gICAgICAgIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxUb3AgPSB0aGlzLl9zY3JvbGxQb3NpdGlvbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBvbkl0ZW1BY3Rpb25LZXkoa2V5OiBEcm9wRG93bkFjdGlvbktleSkge1xuICAgICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICAgICAgY2FzZSBEcm9wRG93bkFjdGlvbktleS5FTlRFUjpcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUVudGVyKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERyb3BEb3duQWN0aW9uS2V5LlNQQUNFOlxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlU3BhY2UoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRHJvcERvd25BY3Rpb25LZXkuRVNDQVBFOlxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRW50ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQWRkSXRlbUZvY3VzZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5jb21iby5hZGRJdGVtVG9Db2xsZWN0aW9uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZVNwYWNlKCkge1xuICAgICAgICBpZiAodGhpcy5pc0FkZEl0ZW1Gb2N1c2VkKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbSh0aGlzLmZvY3VzZWRJdGVtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaXNBZGRJdGVtRm9jdXNlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNlZEl0ZW0gaW5zdGFuY2VvZiBJZ3hDb21ib0FkZEl0ZW1Db21wb25lbnQ7XG4gICAgfVxuXG4gICAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsSGFuZGxlcik7XG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCh0cnVlKTtcbiAgICAgICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpO1xuICAgIH1cbn1cbiJdfQ==
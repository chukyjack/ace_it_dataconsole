/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, Inject, QueryList, ContentChild, ContentChildren, Optional, forwardRef } from '@angular/core';
import { takeUntil, take } from 'rxjs/operators';
import { IgxForOfDirective } from '../directives/for-of/for_of.directive';
import { IGX_COMBO_COMPONENT } from './combo.common';
import { Navigate } from '../drop-down/drop-down.common';
import { IGX_DROPDOWN_BASE } from '../drop-down/drop-down.common';
import { IgxDropDownComponent } from '../drop-down/drop-down.component';
import { DropDownActionKey } from '../drop-down/drop-down.common';
import { IgxComboAddItemComponent } from './combo-add-item.component';
import { IgxComboAPIService } from './combo.api';
import { IgxSelectionAPIService } from '../core/selection';
import { IgxComboItemComponent } from './combo-item.component';
import { DisplayDensityToken } from '../core/density';
/**
 * @hidden
 */
export class IgxComboDropDownComponent extends IgxDropDownComponent {
    /**
     * @param {?} elementRef
     * @param {?} cdr
     * @param {?} selection
     * @param {?} combo
     * @param {?} comboAPI
     * @param {?} _displayDensityOptions
     */
    constructor(elementRef, cdr, selection, combo, comboAPI, _displayDensityOptions) {
        super(elementRef, cdr, selection, _displayDensityOptions);
        this.elementRef = elementRef;
        this.cdr = cdr;
        this.selection = selection;
        this.combo = combo;
        this.comboAPI = comboAPI;
        this._displayDensityOptions = _displayDensityOptions;
        this._scrollPosition = 0;
        /**
         * @hidden
         * \@internal
         */
        this.children = null;
        this.scrollHandler = () => {
            this.comboAPI.disableTransitions = true;
        };
    }
    /**
     * @protected
     * @return {?}
     */
    get scrollContainer() {
        return this.verticalScrollContainer.dc.location.nativeElement;
    }
    /**
     * @protected
     * @return {?}
     */
    get isScrolledToLast() {
        /** @type {?} */
        const scrollTop = this.verticalScrollContainer.getVerticalScroll().scrollTop;
        /** @type {?} */
        const scrollHeight = this.verticalScrollContainer.getVerticalScroll().scrollHeight;
        return Math.floor(scrollTop + this.verticalScrollContainer.igxForContainerSize) === scrollHeight;
    }
    /**
     * @protected
     * @return {?}
     */
    get lastVisibleIndex() {
        return this.combo.totalItemCount ?
            Math.floor(this.combo.itemsMaxHeight / this.combo.itemHeight) :
            this.items.length - 1;
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    onFocus() {
        this._focusedItem = this._focusedItem || this.items[0];
        if (this._focusedItem) {
            this._focusedItem.focused = true;
        }
    }
    /**
     * @hidden \@internal
     * @param {?=} evt
     * @return {?}
     */
    onBlur(evt) {
        if (this._focusedItem) {
            this._focusedItem.focused = false;
            this._focusedItem = null;
        }
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    onToggleOpened() {
        this.onOpened.emit();
    }
    /**
     * @hidden
     * @return {?}
     */
    navigatePrev() {
        if (this._focusedItem.itemIndex === 0 && this.verticalScrollContainer.state.startIndex === 0) {
            this.combo.focusSearchInput(false);
        }
        else {
            super.navigatePrev();
        }
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    navigateFirst() {
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        if (vContainer.state.startIndex === 0) {
            super.navigateItem(0);
            return;
        }
        vContainer.scrollTo(0);
        this.subscribeNext(vContainer, () => {
            this.combo.triggerCheck();
            super.navigateItem(0);
            this.combo.triggerCheck();
        });
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    navigateLast() {
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        /** @type {?} */
        const scrollTarget = this.combo.totalItemCount ?
            this.combo.totalItemCount - 1 :
            Math.max(this.combo.data.length - 1, vContainer.igxForOf.length - 1);
        if (vContainer.igxForOf.length <= vContainer.state.startIndex + vContainer.state.chunkSize) {
            super.navigateItem(this.items.length - 1);
            return;
        }
        vContainer.scrollTo(scrollTarget);
        this.subscribeNext(vContainer, () => {
            this.combo.triggerCheck();
            super.navigateItem(this.items.length - 1);
            this.combo.triggerCheck();
        });
    }
    /**
     * @private
     * @param {?} direction
     * @return {?}
     */
    navigateRemoteItem(direction) {
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        vContainer.addScrollTop(direction * this.combo.itemHeight);
        this.subscribeNext(vContainer, () => {
            if (direction === Navigate.Up) {
                super.navigateItem(0);
            }
            else {
                super.navigateItem(this.focusedItem.itemIndex);
            }
        });
    }
    /**
     * @hidden \@internal
     * @param {?} item
     * @return {?}
     */
    selectItem(item) {
        if (item === null || item === undefined) {
            return;
        }
        this.comboAPI.set_selected_item(item.itemID);
        this._focusedItem = item;
    }
    /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    navigateDown(newIndex) {
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        /** @type {?} */
        const allData = vContainer.igxForOf;
        /** @type {?} */
        const extraScroll = this.combo.isAddButtonVisible() ? 1 : 0;
        /** @type {?} */
        const focusedItem = this.focusedItem;
        /** @type {?} */
        const items = this.items;
        /** @type {?} */
        const children = this.sortedChildren;
        if (focusedItem) {
            if (this.isAddItemFocused()) {
                return;
            }
            if (focusedItem.value === allData[allData.length - 1]) {
                this.focusAddItemButton();
                return;
            }
        }
        /** @type {?} */
        let targetDataIndex = newIndex === -1 ? this.itemIndexInData(this.focusedItem.itemIndex) + 1 : this.itemIndexInData(newIndex);
        /** @type {?} */
        const lastLoadedIndex = vContainer.state.startIndex + vContainer.state.chunkSize - 1;
        if (targetDataIndex < lastLoadedIndex) { // If no scroll is required
            if (newIndex !== -1 || newIndex === children.length - 1 - extraScroll) { // Use normal nav for visible items
                super.navigateItem(newIndex);
            }
        }
        else if (this.isScrolledToLast && targetDataIndex === lastLoadedIndex) { // If already at bottom and target is last item
            super.navigateItem(items.length - 1 - extraScroll); // Focus the last item (excluding Add Button)
        }
        else { // If scroll is required
            // If scroll is required
            // If item is header, find next non-header index
            /** @type {?} */
            const addedIndex = allData[targetDataIndex].isHeader ? this.findNextFocusableItem(targetDataIndex, Navigate.Down, allData) : 0;
            targetDataIndex += addedIndex; // Add steps to the target index
            if (addedIndex === -1) { // If there are no more non-header items & add button is visible
                this.focusAddItemButton();
            }
            else if (targetDataIndex === allData.length - 1 && !this.isScrolledToLast) {
                // If target is very last loaded item, but scroll is not at the bottom (item is in DOM but not visible)
                vContainer.scrollTo(targetDataIndex); // This will not trigger `onChunkLoad`
                super.navigateItem(items.length - 1 - extraScroll); // Target last item (excluding Add Button)
            }
            else { // Perform virtual scroll
                this.subscribeNext(vContainer, () => {
                    // children = all items in the DD (including addItemButton)
                    // length - 2 instead of -1, because we do not want to focus the last loaded item (in DOM, but not visible)
                    // Focus last item (excluding Add Button)
                    super.navigateItem(!addedIndex ? children[children.length - 1 - extraScroll].itemIndex : this.items.length - 2);
                });
                vContainer.scrollTo(targetDataIndex); // Perform virtual scroll
            }
        }
    }
    /**
     * @private
     * @param {?=} newIndex
     * @return {?}
     */
    navigateUp(newIndex) {
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        /** @type {?} */
        const allData = vContainer.igxForOf;
        /** @type {?} */
        const focusedItem = this.focusedItem;
        if (focusedItem.value === allData.find(e => !e.isHeader && !e.hidden)) { // If this is the very first non-header item
            this.focusComboSearch(); // Focus combo search
            return;
        }
        /** @type {?} */
        let targetDataIndex = newIndex === -1 ? this.itemIndexInData(focusedItem.itemIndex) - 1 : this.itemIndexInData(newIndex);
        if (newIndex !== -1) { // If no scroll is required
            if (this.isScrolledToLast && targetDataIndex === vContainer.state.startIndex) {
                // If virt scrollbar is @ bottom, first item is in DOM but not visible
                vContainer.scrollTo(targetDataIndex); // This will not trigger `onChunkLoad`
                super.navigateItem(0); // Focus first visible item
            }
            else {
                super.navigateItem(newIndex); // Use normal navigation
            }
        }
        else { // Perform virtual scroll
            // Perform virtual scroll
            // If item is header, find next non-header index
            /** @type {?} */
            const addedIndex = allData[targetDataIndex].isHeader ? this.findNextFocusableItem(targetDataIndex, Navigate.Up, allData) : 0;
            targetDataIndex -= addedIndex; // Add steps to targetDataIndex
            if (addedIndex === -1) { // If there is no non-header
                vContainer.scrollTo(0);
                this.focusComboSearch(); // Focus combo search;
            }
            else {
                this.subscribeNext(vContainer, () => {
                    super.navigateItem(0); // Focus the first loaded item
                });
                vContainer.scrollTo(targetDataIndex); // Perform virtual scroll
            }
        }
    }
    /**
     * @protected
     * @param {?} direction
     * @param {?=} currentIndex
     * @return {?}
     */
    navigate(direction, currentIndex) {
        /** @type {?} */
        let index = -1;
        if (this._focusedItem) {
            index = currentIndex ? currentIndex : this._focusedItem.itemIndex;
        }
        /** @type {?} */
        const newIndex = this.getNearestSiblingFocusableItemIndex(index, direction);
        /** @type {?} */
        const vContainer = this.verticalScrollContainer;
        /** @type {?} */
        const notVirtual = vContainer.dc.instance.notVirtual;
        if (notVirtual || !direction) { // If list has no scroll OR no direction is passed
            super.navigateItem(newIndex); // use default scroll
        }
        else if (vContainer && vContainer.totalItemCount && vContainer.totalItemCount !== 0) { // Remote scroll
            if (newIndex !== -1 &&
                this.items[newIndex].isVisible(direction)) {
                this.navigateItem(newIndex);
            }
            else {
                this.navigateRemoteItem(direction);
            }
        }
        else {
            if (direction === Navigate.Up) { // Navigate UP
                this.navigateUp(newIndex);
            }
            else if (direction === Navigate.Down) { // Navigate DOWN
                this.navigateDown(newIndex);
            }
        }
    }
    /**
     * @private
     * @param {?} index
     * @return {?}
     */
    itemIndexInData(index) {
        return this.sortedChildren.findIndex(e => e.itemIndex === index) + this.verticalScrollContainer.state.startIndex;
    }
    /**
     * @private
     * @param {?} indexInData
     * @param {?} direction
     * @param {?} data
     * @return {?}
     */
    findNextFocusableItem(indexInData, direction, data) {
        if (direction === Navigate.Up) {
            return [...data].splice(0, indexInData + 1).reverse().findIndex(e => !e.isHeader);
        }
        return [...data].splice(indexInData, data.length - 1).findIndex(e => !e.isHeader);
    }
    /**
     * @private
     * @return {?}
     */
    focusComboSearch() {
        this.combo.focusSearchInput(false);
        if (this.focusedItem) {
            this.focusedItem.focused = false;
        }
        this.focusedItem = null;
    }
    /**
     * @private
     * @return {?}
     */
    focusAddItemButton() {
        if (this.combo.isAddButtonVisible()) {
            super.navigateItem(this.items.length - 1);
        }
    }
    /**
     * @private
     * @param {?} virtualContainer
     * @param {?} callback
     * @return {?}
     */
    subscribeNext(virtualContainer, callback) {
        virtualContainer.onChunkLoad.pipe(take(1), takeUntil(this.destroy$)).subscribe({
            next: (e) => {
                callback(e);
            }
        });
    }
    /**
     * @protected
     * @param {?} newItem
     * @return {?}
     */
    scrollToHiddenItem(newItem) { }
    /**
     * @protected
     * @return {?}
     */
    get sortedChildren() {
        if (this.children !== undefined) {
            return this.children.toArray()
                .sort((a, b) => {
                return a.index - b.index;
            });
        }
        return null;
    }
    /**
     * Get all non-header items
     *
     * ```typescript
     * let myDropDownItems = this.dropdown.items;
     * ```
     * @return {?}
     */
    get items() {
        /** @type {?} */
        const items = [];
        if (this.children !== undefined) {
            /** @type {?} */
            const sortedChildren = (/** @type {?} */ (this.sortedChildren));
            for (const child of sortedChildren) {
                if (!child.isHeader) {
                    items.push(child);
                }
            }
        }
        return items;
    }
    /**
     * @protected
     * @return {?}
     */
    scrollToItem() {
    }
    /**
     * @hidden \@internal
     * @param {?} e
     * @return {?}
     */
    onToggleClosing(e) {
        super.onToggleClosing(e);
        this._scrollPosition = this.verticalScrollContainer.getVerticalScroll().scrollTop;
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    updateScrollPosition() {
        this.verticalScrollContainer.getVerticalScroll().scrollTop = this._scrollPosition;
    }
    /**
     * @hidden \@internal
     * @param {?} key
     * @return {?}
     */
    onItemActionKey(key) {
        switch (key) {
            case DropDownActionKey.ENTER:
                this.handleEnter();
                break;
            case DropDownActionKey.SPACE:
                this.handleSpace();
                break;
            case DropDownActionKey.ESCAPE:
                this.close();
        }
    }
    /**
     * @private
     * @return {?}
     */
    handleEnter() {
        if (this.isAddItemFocused()) {
            this.combo.addItemToCollection();
        }
        else {
            this.close();
        }
    }
    /**
     * @private
     * @return {?}
     */
    handleSpace() {
        if (this.isAddItemFocused()) {
            return;
        }
        else {
            this.selectItem(this.focusedItem);
        }
    }
    /**
     * @private
     * @return {?}
     */
    isAddItemFocused() {
        return this.focusedItem instanceof IgxComboAddItemComponent;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.verticalScrollContainer.getVerticalScroll().addEventListener('scroll', this.scrollHandler);
    }
    /**
     * @hidden \@internal
     * @return {?}
     */
    ngOnDestroy() {
        this.verticalScrollContainer.getVerticalScroll().removeEventListener('scroll', this.scrollHandler);
        this.destroy$.next(true);
        this.destroy$.complete();
    }
}
IgxComboDropDownComponent.decorators = [
    { type: Component, args: [{
                selector: 'igx-combo-drop-down',
                template: "<div class=\"igx-drop-down__list\" igxToggle [style.width]=\"width\" [style.height]=\"height\"\n[style.maxHeight]=\"maxHeight\" [attr.id]=\"this.listId\" role=\"listbox\"\n    (onOpening)=\"onToggleOpening($event)\" (onOpened)=\"onToggleOpened()\"\n    (onClosing)=\"onToggleClosing($event)\" (onClosed)=\"onToggleClosed()\">\n    <ng-container *ngIf=\"!collapsed\">\n        <ng-content></ng-content>\n    </ng-container>\n</div>\n",
                providers: [{ provide: IGX_DROPDOWN_BASE, useExisting: IgxComboDropDownComponent }]
            }] }
];
/** @nocollapse */
IgxComboDropDownComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: ChangeDetectorRef },
    { type: IgxSelectionAPIService },
    { type: undefined, decorators: [{ type: Inject, args: [IGX_COMBO_COMPONENT,] }] },
    { type: IgxComboAPIService },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DisplayDensityToken,] }] }
];
IgxComboDropDownComponent.propDecorators = {
    children: [{ type: ContentChildren, args: [IgxComboItemComponent, { descendants: true },] }],
    verticalScrollContainer: [{ type: ContentChild, args: [forwardRef(() => IgxForOfDirective), { read: IgxForOfDirective },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    IgxComboDropDownComponent.prototype._scrollPosition;
    /**
     * @hidden
     * \@internal
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.children;
    /**
     * @hidden \@internal
     * @type {?}
     */
    IgxComboDropDownComponent.prototype.verticalScrollContainer;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.scrollHandler;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.elementRef;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.cdr;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.selection;
    /** @type {?} */
    IgxComboDropDownComponent.prototype.combo;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype.comboAPI;
    /**
     * @type {?}
     * @protected
     */
    IgxComboDropDownComponent.prototype._displayDensityOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vaWduaXRldWktYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9jb21iby9jb21iby1kcm9wZG93bi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQTRCLFlBQVksRUFBRSxlQUFlLEVBQUUsUUFBUSxFQUM5SCxVQUFVLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUUxRSxPQUFPLEVBQWdCLG1CQUFtQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3pELE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNqRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNsRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN0RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFakQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDM0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDL0QsT0FBTyxFQUFFLG1CQUFtQixFQUEwQixNQUFNLGlCQUFpQixDQUFDOzs7O0FBUTlFLE1BQU0sT0FBTyx5QkFBMEIsU0FBUSxvQkFBb0I7Ozs7Ozs7OztJQUMvRCxZQUNjLFVBQXNC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a0I7NENBbUJsQixRQUFRLFlBQUksTUFBTSxTQUFDLG1CQUFtQjs7O3VCQTBCMUMsZUFBZSxTQUFDLHFCQUFxQixFQUFFLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRTtzQ0FNNUQsWUFBWSxTQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFOzs7Ozs7O0lBWjlFLG9EQUE0Qjs7Ozs7O0lBTTVCLDZDQUN1RDs7Ozs7SUFLdkQsNERBQ3VEOzs7OztJQTZPdkQsa0RBRUM7Ozs7O0lBclJHLCtDQUFnQzs7Ozs7SUFDaEMsd0NBQWdDOzs7OztJQUNoQyw4Q0FBMkM7O0lBQzNDLDBDQUF1RDs7Ozs7SUFDdkQsNkNBQXNDOzs7OztJQUN0QywyREFBaUciLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEluamVjdCwgUXVlcnlMaXN0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIENvbnRlbnRDaGlsZCwgQ29udGVudENoaWxkcmVuLCBPcHRpb25hbCxcbiAgICBmb3J3YXJkUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSWd4Rm9yT2ZEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL2Zvci1vZi9mb3Jfb2YuZGlyZWN0aXZlJztcbmltcG9ydCB7IENhbmNlbGFibGVCcm93c2VyRXZlbnRBcmdzIH0gZnJvbSAnLi4vY29yZS91dGlscyc7XG5pbXBvcnQgeyBJZ3hDb21ib0Jhc2UsIElHWF9DT01CT19DT01QT05FTlQgfSBmcm9tICcuL2NvbWJvLmNvbW1vbic7XG5pbXBvcnQgeyBOYXZpZ2F0ZSB9IGZyb20gJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24uY29tbW9uJztcbmltcG9ydCB7IElEcm9wRG93bkJhc2UsIElHWF9EUk9QRE9XTl9CQVNFIH0gZnJvbSAnLi4vZHJvcC1kb3duL2Ryb3AtZG93bi5jb21tb24nO1xuaW1wb3J0IHsgSWd4RHJvcERvd25Db21wb25lbnQgfSBmcm9tICcuLi9kcm9wLWRvd24vZHJvcC1kb3duLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEcm9wRG93bkFjdGlvbktleSB9IGZyb20gJy4uL2Ryb3AtZG93bi9kcm9wLWRvd24uY29tbW9uJztcbmltcG9ydCB7IElneENvbWJvQWRkSXRlbUNvbXBvbmVudCB9IGZyb20gJy4vY29tYm8tYWRkLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IElneENvbWJvQVBJU2VydmljZSB9IGZyb20gJy4vY29tYm8uYXBpJztcbmltcG9ydCB7IElneERyb3BEb3duSXRlbUJhc2UgfSBmcm9tICcuLi9kcm9wLWRvd24vZHJvcC1kb3duLWl0ZW0uYmFzZSc7XG5pbXBvcnQgeyBJZ3hTZWxlY3Rpb25BUElTZXJ2aWNlIH0gZnJvbSAnLi4vY29yZS9zZWxlY3Rpb24nO1xuaW1wb3J0IHsgSWd4Q29tYm9JdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9jb21iby1pdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBEaXNwbGF5RGVuc2l0eVRva2VuLCBJRGlzcGxheURlbnNpdHlPcHRpb25zIH0gZnJvbSAnLi4vY29yZS9kZW5zaXR5JztcblxuLyoqIEBoaWRkZW4gKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnaWd4LWNvbWJvLWRyb3AtZG93bicsXG4gICAgdGVtcGxhdGVVcmw6ICcuLi9kcm9wLWRvd24vZHJvcC1kb3duLmNvbXBvbmVudC5odG1sJyxcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IElHWF9EUk9QRE9XTl9CQVNFLCB1c2VFeGlzdGluZzogSWd4Q29tYm9Ecm9wRG93bkNvbXBvbmVudCB9XVxufSlcbmV4cG9ydCBjbGFzcyBJZ3hDb21ib0Ryb3BEb3duQ29tcG9uZW50IGV4dGVuZHMgSWd4RHJvcERvd25Db21wb25lbnQgaW1wbGVtZW50cyBJRHJvcERvd25CYXNlLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgcHJvdGVjdGVkIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgICAgIHByb3RlY3RlZCBzZWxlY3Rpb246IElneFNlbGVjdGlvbkFQSVNlcnZpY2UsXG4gICAgICAgIEBJbmplY3QoSUdYX0NPTUJPX0NPTVBPTkVOVCkgcHVibGljIGNvbWJvOiBJZ3hDb21ib0Jhc2UsXG4gICAgICAgIHByb3RlY3RlZCBjb21ib0FQSTogSWd4Q29tYm9BUElTZXJ2aWNlLFxuICAgICAgICBAT3B0aW9uYWwoKSBASW5qZWN0KERpc3BsYXlEZW5zaXR5VG9rZW4pIHByb3RlY3RlZCBfZGlzcGxheURlbnNpdHlPcHRpb25zOiBJRGlzcGxheURlbnNpdHlPcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKGVsZW1lbnRSZWYsIGNkciwgc2VsZWN0aW9uLCBfZGlzcGxheURlbnNpdHlPcHRpb25zKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IHNjcm9sbENvbnRhaW5lcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZGMubG9jYXRpb24ubmF0aXZlRWxlbWVudDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGlzU2Nyb2xsZWRUb0xhc3QoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxUb3A7XG4gICAgICAgIGNvbnN0IHNjcm9sbEhlaWdodCA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKHNjcm9sbFRvcCArIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuaWd4Rm9yQ29udGFpbmVyU2l6ZSkgPT09IHNjcm9sbEhlaWdodDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGxhc3RWaXNpYmxlSW5kZXgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYm8udG90YWxJdGVtQ291bnQgP1xuICAgICAgICAgICAgTWF0aC5mbG9vcih0aGlzLmNvbWJvLml0ZW1zTWF4SGVpZ2h0IC8gdGhpcy5jb21iby5pdGVtSGVpZ2h0KSA6XG4gICAgICAgICAgICB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2Nyb2xsUG9zaXRpb24gPSAwO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIEBDb250ZW50Q2hpbGRyZW4oSWd4Q29tYm9JdGVtQ29tcG9uZW50LCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pXG4gICAgcHVibGljIGNoaWxkcmVuOiBRdWVyeUxpc3Q8SWd4RHJvcERvd25JdGVtQmFzZT4gPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gSWd4Rm9yT2ZEaXJlY3RpdmUpLCB7IHJlYWQ6IElneEZvck9mRGlyZWN0aXZlIH0pXG4gICAgcHVibGljIHZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyOiBJZ3hGb3JPZkRpcmVjdGl2ZTxhbnk+O1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgb25Gb2N1cygpIHtcbiAgICAgICAgdGhpcy5fZm9jdXNlZEl0ZW0gPSB0aGlzLl9mb2N1c2VkSXRlbSB8fCB0aGlzLml0ZW1zWzBdO1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzZWRJdGVtLmZvY3VzZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgb25CbHVyKGV2dD8pIHtcbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzZWRJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbS5mb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9mb2N1c2VkSXRlbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBvblRvZ2dsZU9wZW5lZCgpIHtcbiAgICAgICAgdGhpcy5vbk9wZW5lZC5lbWl0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBwdWJsaWMgbmF2aWdhdGVQcmV2KCkge1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEl0ZW0uaXRlbUluZGV4ID09PSAwICYmIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuc3RhdGUuc3RhcnRJbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5jb21iby5mb2N1c1NlYXJjaElucHV0KGZhbHNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlUHJldigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgbmF2aWdhdGVGaXJzdCgpIHtcbiAgICAgICAgY29uc3QgdkNvbnRhaW5lciA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXI7XG4gICAgICAgIGlmICh2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSgwKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2Q29udGFpbmVyLnNjcm9sbFRvKDApO1xuICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSgwKTtcbiAgICAgICAgICAgIHRoaXMuY29tYm8udHJpZ2dlckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBoaWRkZW4gQGludGVybmFsXG4gICAgICovXG4gICAgcHVibGljIG5hdmlnYXRlTGFzdCgpIHtcbiAgICAgICAgY29uc3QgdkNvbnRhaW5lciA9IHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXI7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRhcmdldCA9IHRoaXMuY29tYm8udG90YWxJdGVtQ291bnQgP1xuICAgICAgICAgICAgdGhpcy5jb21iby50b3RhbEl0ZW1Db3VudCAtIDEgOlxuICAgICAgICAgICAgTWF0aC5tYXgodGhpcy5jb21iby5kYXRhLmxlbmd0aCAtIDEsIHZDb250YWluZXIuaWd4Rm9yT2YubGVuZ3RoIC0gMSk7XG4gICAgICAgIGlmICh2Q29udGFpbmVyLmlneEZvck9mLmxlbmd0aCA8PSB2Q29udGFpbmVyLnN0YXRlLnN0YXJ0SW5kZXggKyB2Q29udGFpbmVyLnN0YXRlLmNodW5rU2l6ZSkge1xuICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKHRoaXMuaXRlbXMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbyhzY3JvbGxUYXJnZXQpO1xuICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbSh0aGlzLml0ZW1zLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgdGhpcy5jb21iby50cmlnZ2VyQ2hlY2soKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuYXZpZ2F0ZVJlbW90ZUl0ZW0oZGlyZWN0aW9uOiBOYXZpZ2F0ZSkge1xuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgdkNvbnRhaW5lci5hZGRTY3JvbGxUb3AoZGlyZWN0aW9uICogdGhpcy5jb21iby5pdGVtSGVpZ2h0KTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVOZXh0KHZDb250YWluZXIsICgpID0+IHtcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24gPT09IE5hdmlnYXRlLlVwKSB7XG4gICAgICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0odGhpcy5mb2N1c2VkSXRlbS5pdGVtSW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHB1YmxpYyBzZWxlY3RJdGVtKGl0ZW06IElneERyb3BEb3duSXRlbUJhc2UpIHtcbiAgICAgICAgaWYgKGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb21ib0FQSS5zZXRfc2VsZWN0ZWRfaXRlbShpdGVtLml0ZW1JRCk7XG4gICAgICAgIHRoaXMuX2ZvY3VzZWRJdGVtID0gaXRlbTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG5hdmlnYXRlRG93bihuZXdJbmRleD86IG51bWJlcikge1xuICAgICAgICBjb25zdCB2Q29udGFpbmVyID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgY29uc3QgYWxsRGF0YSA9IHZDb250YWluZXIuaWd4Rm9yT2Y7XG4gICAgICAgIGNvbnN0IGV4dHJhU2Nyb2xsID0gdGhpcy5jb21iby5pc0FkZEJ1dHRvblZpc2libGUoKSA/IDEgOiAwO1xuICAgICAgICBjb25zdCBmb2N1c2VkSXRlbSA9IHRoaXMuZm9jdXNlZEl0ZW07XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pdGVtcztcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLnNvcnRlZENoaWxkcmVuO1xuICAgICAgICBpZiAoZm9jdXNlZEl0ZW0pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWRkSXRlbUZvY3VzZWQoKSkgeyByZXR1cm47IH1cbiAgICAgICAgICAgIGlmIChmb2N1c2VkSXRlbS52YWx1ZSA9PT0gYWxsRGF0YVthbGxEYXRhLmxlbmd0aCAtIDFdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c0FkZEl0ZW1CdXR0b24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRhcmdldERhdGFJbmRleCA9IG5ld0luZGV4ID09PSAtMSA/IHRoaXMuaXRlbUluZGV4SW5EYXRhKHRoaXMuZm9jdXNlZEl0ZW0uaXRlbUluZGV4KSArIDEgOiB0aGlzLml0ZW1JbmRleEluRGF0YShuZXdJbmRleCk7XG4gICAgICAgIGNvbnN0IGxhc3RMb2FkZWRJbmRleCA9IHZDb250YWluZXIuc3RhdGUuc3RhcnRJbmRleCArIHZDb250YWluZXIuc3RhdGUuY2h1bmtTaXplIC0gMTsgLy8gTGFzdCBpdGVtIGlzIG5vdCB2aXNpYmxlLCBzbyByZXF1aXJlIHNjcm9sbFxuICAgICAgICBpZiAodGFyZ2V0RGF0YUluZGV4IDwgbGFzdExvYWRlZEluZGV4KSB7IC8vIElmIG5vIHNjcm9sbCBpcyByZXF1aXJlZFxuICAgICAgICAgICAgaWYgKG5ld0luZGV4ICE9PSAtMSB8fCBuZXdJbmRleCA9PT0gY2hpbGRyZW4ubGVuZ3RoIC0gMSAtIGV4dHJhU2Nyb2xsKSB7IC8vIFVzZSBub3JtYWwgbmF2IGZvciB2aXNpYmxlIGl0ZW1zXG4gICAgICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKG5ld0luZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzU2Nyb2xsZWRUb0xhc3QgJiYgdGFyZ2V0RGF0YUluZGV4ID09PSBsYXN0TG9hZGVkSW5kZXgpIHsgLy8gSWYgYWxyZWFkeSBhdCBib3R0b20gYW5kIHRhcmdldCBpcyBsYXN0IGl0ZW1cbiAgICAgICAgICAgIHN1cGVyLm5hdmlnYXRlSXRlbShpdGVtcy5sZW5ndGggLSAxIC0gZXh0cmFTY3JvbGwpOyAvLyBGb2N1cyB0aGUgbGFzdCBpdGVtIChleGNsdWRpbmcgQWRkIEJ1dHRvbilcbiAgICAgICAgfSBlbHNlIHsgLy8gSWYgc2Nyb2xsIGlzIHJlcXVpcmVkXG4gICAgICAgICAgICAvLyBJZiBpdGVtIGlzIGhlYWRlciwgZmluZCBuZXh0IG5vbi1oZWFkZXIgaW5kZXhcbiAgICAgICAgICAgIGNvbnN0IGFkZGVkSW5kZXggPSBhbGxEYXRhW3RhcmdldERhdGFJbmRleF0uaXNIZWFkZXIgPyB0aGlzLmZpbmROZXh0Rm9jdXNhYmxlSXRlbSh0YXJnZXREYXRhSW5kZXgsIE5hdmlnYXRlLkRvd24sIGFsbERhdGEpIDogMDtcbiAgICAgICAgICAgIHRhcmdldERhdGFJbmRleCArPSBhZGRlZEluZGV4OyAvLyBBZGQgc3RlcHMgdG8gdGhlIHRhcmdldCBpbmRleFxuICAgICAgICAgICAgaWYgKGFkZGVkSW5kZXggPT09IC0xKSB7IC8vIElmIHRoZXJlIGFyZSBubyBtb3JlIG5vbi1oZWFkZXIgaXRlbXMgJiBhZGQgYnV0dG9uIGlzIHZpc2libGVcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzQWRkSXRlbUJ1dHRvbigpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXREYXRhSW5kZXggPT09IGFsbERhdGEubGVuZ3RoIC0gMSAmJiAhdGhpcy5pc1Njcm9sbGVkVG9MYXN0KSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGFyZ2V0IGlzIHZlcnkgbGFzdCBsb2FkZWQgaXRlbSwgYnV0IHNjcm9sbCBpcyBub3QgYXQgdGhlIGJvdHRvbSAoaXRlbSBpcyBpbiBET00gYnV0IG5vdCB2aXNpYmxlKVxuICAgICAgICAgICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8odGFyZ2V0RGF0YUluZGV4KTsgLy8gVGhpcyB3aWxsIG5vdCB0cmlnZ2VyIGBvbkNodW5rTG9hZGBcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0oaXRlbXMubGVuZ3RoIC0gMSAtIGV4dHJhU2Nyb2xsKTsgLy8gVGFyZ2V0IGxhc3QgaXRlbSAoZXhjbHVkaW5nIEFkZCBCdXR0b24pXG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBQZXJmb3JtIHZpcnR1YWwgc2Nyb2xsXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVOZXh0KHZDb250YWluZXIsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hpbGRyZW4gPSBhbGwgaXRlbXMgaW4gdGhlIEREIChpbmNsdWRpbmcgYWRkSXRlbUJ1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgLy8gbGVuZ3RoIC0gMiBpbnN0ZWFkIG9mIC0xLCBiZWNhdXNlIHdlIGRvIG5vdCB3YW50IHRvIGZvY3VzIHRoZSBsYXN0IGxvYWRlZCBpdGVtIChpbiBET00sIGJ1dCBub3QgdmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgICAgLy8gRm9jdXMgbGFzdCBpdGVtIChleGNsdWRpbmcgQWRkIEJ1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgc3VwZXIubmF2aWdhdGVJdGVtKCFhZGRlZEluZGV4ID8gY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoIC0gMSAtIGV4dHJhU2Nyb2xsXS5pdGVtSW5kZXggOiB0aGlzLml0ZW1zLmxlbmd0aCAtIDIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8odGFyZ2V0RGF0YUluZGV4KTsgLy8gUGVyZm9ybSB2aXJ0dWFsIHNjcm9sbFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuYXZpZ2F0ZVVwKG5ld0luZGV4PzogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHZDb250YWluZXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyO1xuICAgICAgICBjb25zdCBhbGxEYXRhID0gdkNvbnRhaW5lci5pZ3hGb3JPZjtcbiAgICAgICAgY29uc3QgZm9jdXNlZEl0ZW0gPSB0aGlzLmZvY3VzZWRJdGVtO1xuICAgICAgICBpZiAoZm9jdXNlZEl0ZW0udmFsdWUgPT09IGFsbERhdGEuZmluZChlID0+ICFlLmlzSGVhZGVyICYmICFlLmhpZGRlbikpIHsgLy8gSWYgdGhpcyBpcyB0aGUgdmVyeSBmaXJzdCBub24taGVhZGVyIGl0ZW1cbiAgICAgICAgICAgIHRoaXMuZm9jdXNDb21ib1NlYXJjaCgpOyAvLyBGb2N1cyBjb21ibyBzZWFyY2hcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0RGF0YUluZGV4ID0gbmV3SW5kZXggPT09IC0xID8gdGhpcy5pdGVtSW5kZXhJbkRhdGEoZm9jdXNlZEl0ZW0uaXRlbUluZGV4KSAtIDEgOiB0aGlzLml0ZW1JbmRleEluRGF0YShuZXdJbmRleCk7XG4gICAgICAgIGlmIChuZXdJbmRleCAhPT0gLTEpIHsgLy8gSWYgbm8gc2Nyb2xsIGlzIHJlcXVpcmVkXG4gICAgICAgICAgICBpZiAodGhpcy5pc1Njcm9sbGVkVG9MYXN0ICYmIHRhcmdldERhdGFJbmRleCA9PT0gdkNvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdmlydCBzY3JvbGxiYXIgaXMgQCBib3R0b20sIGZpcnN0IGl0ZW0gaXMgaW4gRE9NIGJ1dCBub3QgdmlzaWJsZVxuICAgICAgICAgICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8odGFyZ2V0RGF0YUluZGV4KTsgLy8gVGhpcyB3aWxsIG5vdCB0cmlnZ2VyIGBvbkNodW5rTG9hZGBcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0oMCk7IC8vIEZvY3VzIGZpcnN0IHZpc2libGUgaXRlbVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0obmV3SW5kZXgpOyAvLyBVc2Ugbm9ybWFsIG5hdmlnYXRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHsgLy8gUGVyZm9ybSB2aXJ0dWFsIHNjcm9sbFxuICAgICAgICAgICAgLy8gSWYgaXRlbSBpcyBoZWFkZXIsIGZpbmQgbmV4dCBub24taGVhZGVyIGluZGV4XG4gICAgICAgICAgICBjb25zdCBhZGRlZEluZGV4ID0gYWxsRGF0YVt0YXJnZXREYXRhSW5kZXhdLmlzSGVhZGVyID8gdGhpcy5maW5kTmV4dEZvY3VzYWJsZUl0ZW0odGFyZ2V0RGF0YUluZGV4LCBOYXZpZ2F0ZS5VcCwgYWxsRGF0YSkgOiAwO1xuICAgICAgICAgICAgdGFyZ2V0RGF0YUluZGV4IC09IGFkZGVkSW5kZXg7IC8vIEFkZCBzdGVwcyB0byB0YXJnZXREYXRhSW5kZXhcbiAgICAgICAgICAgIGlmIChhZGRlZEluZGV4ID09PSAtMSkgeyAvLyBJZiB0aGVyZSBpcyBubyBub24taGVhZGVyXG4gICAgICAgICAgICAgICAgdkNvbnRhaW5lci5zY3JvbGxUbygwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzQ29tYm9TZWFyY2goKTsgLy8gRm9jdXMgY29tYm8gc2VhcmNoO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZU5leHQodkNvbnRhaW5lciwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0oMCk7IC8vIEZvY3VzIHRoZSBmaXJzdCBsb2FkZWQgaXRlbVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZDb250YWluZXIuc2Nyb2xsVG8odGFyZ2V0RGF0YUluZGV4KTsgLy8gUGVyZm9ybSB2aXJ0dWFsIHNjcm9sbFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG5hdmlnYXRlKGRpcmVjdGlvbjogTmF2aWdhdGUsIGN1cnJlbnRJbmRleD86IG51bWJlcikge1xuICAgICAgICBsZXQgaW5kZXggPSAtMTtcbiAgICAgICAgaWYgKHRoaXMuX2ZvY3VzZWRJdGVtKSB7XG4gICAgICAgICAgICBpbmRleCA9IGN1cnJlbnRJbmRleCA/IGN1cnJlbnRJbmRleCA6IHRoaXMuX2ZvY3VzZWRJdGVtLml0ZW1JbmRleDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdJbmRleCA9IHRoaXMuZ2V0TmVhcmVzdFNpYmxpbmdGb2N1c2FibGVJdGVtSW5kZXgoaW5kZXgsIGRpcmVjdGlvbik7XG4gICAgICAgIGNvbnN0IHZDb250YWluZXIgPSB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyO1xuICAgICAgICBjb25zdCBub3RWaXJ0dWFsID0gdkNvbnRhaW5lci5kYy5pbnN0YW5jZS5ub3RWaXJ0dWFsO1xuICAgICAgICBpZiAobm90VmlydHVhbCB8fCAhZGlyZWN0aW9uKSB7IC8vIElmIGxpc3QgaGFzIG5vIHNjcm9sbCBPUiBubyBkaXJlY3Rpb24gaXMgcGFzc2VkXG4gICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0obmV3SW5kZXgpOyAvLyB1c2UgZGVmYXVsdCBzY3JvbGxcbiAgICAgICAgfSBlbHNlIGlmICh2Q29udGFpbmVyICYmIHZDb250YWluZXIudG90YWxJdGVtQ291bnQgJiYgdkNvbnRhaW5lci50b3RhbEl0ZW1Db3VudCAhPT0gMCkgeyAvLyBSZW1vdGUgc2Nyb2xsXG4gICAgICAgICAgICBpZiAobmV3SW5kZXggIT09IC0xICYmXG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtc1tuZXdJbmRleF0uaXNWaXNpYmxlKGRpcmVjdGlvbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlSXRlbShuZXdJbmRleCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVSZW1vdGVJdGVtKGRpcmVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBOYXZpZ2F0ZS5VcCkgeyAvLyBOYXZpZ2F0ZSBVUFxuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVVcChuZXdJbmRleCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuRG93bikgeyAvLyBOYXZpZ2F0ZSBET1dOXG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZURvd24obmV3SW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpdGVtSW5kZXhJbkRhdGEoaW5kZXg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRDaGlsZHJlbi5maW5kSW5kZXgoZSA9PiBlLml0ZW1JbmRleCA9PT0gaW5kZXgpICsgdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5zdGF0ZS5zdGFydEluZGV4O1xuICAgIH1cblxuICAgIHByaXZhdGUgZmluZE5leHRGb2N1c2FibGVJdGVtKGluZGV4SW5EYXRhOiBudW1iZXIsIGRpcmVjdGlvbjogTmF2aWdhdGUsIGRhdGE6IGFueVtdKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gTmF2aWdhdGUuVXApIHtcbiAgICAgICAgICAgIHJldHVybiBbLi4uZGF0YV0uc3BsaWNlKDAsIGluZGV4SW5EYXRhICsgMSkucmV2ZXJzZSgpLmZpbmRJbmRleChlID0+ICFlLmlzSGVhZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gWy4uLmRhdGFdLnNwbGljZShpbmRleEluRGF0YSwgZGF0YS5sZW5ndGggLSAxKS5maW5kSW5kZXgoZSA9PiAhZS5pc0hlYWRlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb2N1c0NvbWJvU2VhcmNoKCkge1xuICAgICAgICB0aGlzLmNvbWJvLmZvY3VzU2VhcmNoSW5wdXQoZmFsc2UpO1xuICAgICAgICBpZiAodGhpcy5mb2N1c2VkSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5mb2N1c2VkSXRlbS5mb2N1c2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mb2N1c2VkSXRlbSA9IG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb2N1c0FkZEl0ZW1CdXR0b24oKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbWJvLmlzQWRkQnV0dG9uVmlzaWJsZSgpKSB7XG4gICAgICAgICAgICBzdXBlci5uYXZpZ2F0ZUl0ZW0odGhpcy5pdGVtcy5sZW5ndGggLSAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3Vic2NyaWJlTmV4dCh2aXJ0dWFsQ29udGFpbmVyOiBhbnksIGNhbGxiYWNrOiAoZWxlbT8pID0+IHZvaWQpIHtcbiAgICAgICAgdmlydHVhbENvbnRhaW5lci5vbkNodW5rTG9hZC5waXBlKHRha2UoMSksIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6IChlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNjcm9sbFRvSGlkZGVuSXRlbShuZXdJdGVtOiBhbnkpOiB2b2lkIHsgfVxuXG4gICAgcHJvdGVjdGVkIHNjcm9sbEhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29tYm9BUEkuZGlzYWJsZVRyYW5zaXRpb25zID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IHNvcnRlZENoaWxkcmVuKCk6IElneERyb3BEb3duSXRlbUJhc2VbXSB7XG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLnRvQXJyYXkoKVxuICAgICAgICAgICAgICAgIC5zb3J0KChhOiBJZ3hEcm9wRG93bkl0ZW1CYXNlLCBiOiBJZ3hEcm9wRG93bkl0ZW1CYXNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmluZGV4IC0gYi5pbmRleDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIG5vbi1oZWFkZXIgaXRlbXNcbiAgICAgKlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBsZXQgbXlEcm9wRG93bkl0ZW1zID0gdGhpcy5kcm9wZG93bi5pdGVtcztcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGl0ZW1zKCk6IElneENvbWJvSXRlbUNvbXBvbmVudFtdIHtcbiAgICAgICAgY29uc3QgaXRlbXM6IElneENvbWJvSXRlbUNvbXBvbmVudFtdID0gW107XG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZENoaWxkcmVuID0gdGhpcy5zb3J0ZWRDaGlsZHJlbiBhcyBJZ3hDb21ib0l0ZW1Db21wb25lbnRbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygc29ydGVkQ2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkLmlzSGVhZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpdGVtcztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2Nyb2xsVG9JdGVtKCkge1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIG9uVG9nZ2xlQ2xvc2luZyhlOiBDYW5jZWxhYmxlQnJvd3NlckV2ZW50QXJncykge1xuICAgICAgICBzdXBlci5vblRvZ2dsZUNsb3NpbmcoZSk7XG4gICAgICAgIHRoaXMuX3Njcm9sbFBvc2l0aW9uID0gdGhpcy52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lci5nZXRWZXJ0aWNhbFNjcm9sbCgpLnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHVwZGF0ZVNjcm9sbFBvc2l0aW9uKCkge1xuICAgICAgICB0aGlzLnZlcnRpY2FsU2Nyb2xsQ29udGFpbmVyLmdldFZlcnRpY2FsU2Nyb2xsKCkuc2Nyb2xsVG9wID0gdGhpcy5fc2Nyb2xsUG9zaXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgb25JdGVtQWN0aW9uS2V5KGtleTogRHJvcERvd25BY3Rpb25LZXkpIHtcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgRHJvcERvd25BY3Rpb25LZXkuRU5URVI6XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVFbnRlcigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEcm9wRG93bkFjdGlvbktleS5TUEFDRTpcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVNwYWNlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERyb3BEb3duQWN0aW9uS2V5LkVTQ0FQRTpcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhhbmRsZUVudGVyKCkge1xuICAgICAgICBpZiAodGhpcy5pc0FkZEl0ZW1Gb2N1c2VkKCkpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYm8uYWRkSXRlbVRvQ29sbGVjdGlvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVTcGFjZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNBZGRJdGVtRm9jdXNlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0odGhpcy5mb2N1c2VkSXRlbSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQWRkSXRlbUZvY3VzZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZvY3VzZWRJdGVtIGluc3RhbmNlb2YgSWd4Q29tYm9BZGRJdGVtQ29tcG9uZW50O1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqQGhpZGRlbiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMudmVydGljYWxTY3JvbGxDb250YWluZXIuZ2V0VmVydGljYWxTY3JvbGwoKS5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnNjcm9sbEhhbmRsZXIpO1xuICAgICAgICB0aGlzLmRlc3Ryb3kkLm5leHQodHJ1ZSk7XG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG59XG4iXX0=
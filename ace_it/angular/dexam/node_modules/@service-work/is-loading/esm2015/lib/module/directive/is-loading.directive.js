/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Renderer2, ElementRef, ComponentFactoryResolver, Injector, Inject, Optional, } from '@angular/core';
import { Observable, Subscription } from 'rxjs';
import { IsLoadingService } from '../../is-loading.service';
import { IsLoadingSpinnerComponent } from './is-loading-spinner.component';
import { SW_IS_LOADING_DIRECTIVE_CONFIG, } from './is-loading.directive.config';
// This code was inspired by angular2-promise-buttons
// https://github.com/johannesjo/angular2-promise-buttons
export class IsLoadingDirective {
    /**
     * @param {?} config
     * @param {?} renderer
     * @param {?} isLoadingService
     * @param {?} el
     * @param {?} componentFactoryResolver
     * @param {?} injector
     */
    constructor(config, renderer, isLoadingService, el, componentFactoryResolver, injector) {
        this.renderer = renderer;
        this.isLoadingService = isLoadingService;
        this.el = el;
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this._isLoading = false;
        this.config = {};
        this._swIsLoadingDisableEl = this.config.disableEl === undefined ? true : this.config.disableEl;
        this._swIsLoadingSpinner = this.config.addSpinnerEl !== undefined
            ? this.config.addSpinnerEl
            : this.el.nativeElement instanceof HTMLButtonElement ||
                this.el.nativeElement instanceof HTMLAnchorElement;
        this.loadingClass = this.config.loadingClass
            ? this.config.loadingClass
            : 'sw-is-loading';
        this.config = config || {};
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set swIsLoading(value) {
        if (typeof value === 'string') {
            this.stringValue(value);
        }
        else {
            this.notStringValue();
        }
        if (value instanceof Subscription) {
            this.subscriptionValue(value);
        }
        else {
            this.notSubscriptionValue();
        }
        if (value instanceof Promise) {
            this.promiseValue(value);
        }
        else {
            this.notPromiseValue();
        }
        if (typeof value === 'boolean') {
            this.booleanValue(value);
        }
        else {
            this.notBooleanValue();
        }
        if (value instanceof Observable) {
            this.observableValue();
        }
        else {
            this.notObservableValue();
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set swIsLoadingDisableEl(value) {
        this._swIsLoadingDisableEl = coerceBooleanValue(value);
    }
    /**
     * @return {?}
     */
    get swIsLoadingDisableEl() {
        return this._swIsLoadingDisableEl;
    }
    // By default, if this directive is attached to an anchor or a button
    // element, add a `sw-is-loading-spinner` element to the dom (for styling)
    /**
     * @param {?} value
     * @return {?}
     */
    set swIsLoadingSpinner(value) {
        this._swIsLoadingSpinner = coerceBooleanValue(value);
    }
    /**
     * @return {?}
     */
    get swIsLoadingSpinner() {
        return this._swIsLoadingSpinner;
    }
    /**
     * @return {?}
     */
    get isLoading() {
        return this._isLoading;
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    set pending(value) {
        this.startLoading();
        value.finally((/**
         * @return {?}
         */
        () => this.stopLoading()));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.swIsLoadingSpinner &&
            !changes.swIsLoadingSpinner.isFirstChange() &&
            !changes.swIsLoadingSpinner.currentValue) {
            this.removeSpinnerEl();
        }
        if (changes.swIsLoadingDisableEl &&
            !changes.swIsLoadingDisableEl.isFirstChange() &&
            !changes.swIsLoadingDisableEl.currentValue) {
            this.renderer.removeAttribute(this.el.nativeElement, 'disabled');
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (this.swIsLoadingSpinner) {
            this.addSpinnerEl();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
    }
    /**
     * @private
     * @return {?}
     */
    startLoading() {
        this.renderer.addClass(this.el.nativeElement, this.loadingClass);
        if (this.swIsLoadingDisableEl) {
            this.renderer.setAttribute(this.el.nativeElement, 'disabled', 'disabled');
        }
        this._isLoading = true;
    }
    /**
     * @private
     * @return {?}
     */
    stopLoading() {
        this.renderer.removeClass(this.el.nativeElement, this.loadingClass);
        if (this.swIsLoadingDisableEl) {
            this.renderer.removeAttribute(this.el.nativeElement, 'disabled');
        }
        this._isLoading = false;
    }
    /**
     * @private
     * @return {?}
     */
    addSpinnerEl() {
        this.spinnerEl = this.componentFactoryResolver
            .resolveComponentFactory(IsLoadingSpinnerComponent)
            .create(this.injector);
        // need to use Renderer2#appendChild instead of
        // ViewContainerRef#createComponent because the injected
        // view container is not for the element this directive
        // is applied to
        this.renderer.appendChild(this.el.nativeElement, this.spinnerEl.instance.el.nativeElement);
    }
    /**
     * @private
     * @return {?}
     */
    removeSpinnerEl() {
        if (!this.spinnerEl)
            return;
        this.renderer.removeChild(this.el.nativeElement, this.spinnerEl.instance.el.nativeElement);
        this.spinnerEl.destroy();
        this.spinnerEl = undefined;
    }
    /**
     * Input value handlers
     * @private
     * @param {?} value
     * @return {?}
     */
    stringValue(value) {
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
        /** @type {?} */
        let obs;
        if (!value) {
            obs = this.isLoadingService.isLoading$();
        }
        else {
            obs = this.isLoadingService.isLoading$({
                key: value,
            });
        }
        this.textValueSubscription = obs.subscribe((/**
         * @param {?} loading
         * @return {?}
         */
        loading => {
            if (loading) {
                this.startLoading();
            }
            else if (this.isLoading) {
                this.stopLoading();
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    notStringValue() {
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
    }
    /**
     * @private
     * @return {?}
     */
    observableValue() {
        throw new TypeError('swBtnPending must be an instance of Subscription, instance of Observable given');
    }
    /**
     * @private
     * @return {?}
     */
    notObservableValue() { }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    subscriptionValue(value) {
        this.pending = new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        resolve => value.add(resolve)));
    }
    /**
     * @private
     * @return {?}
     */
    notSubscriptionValue() { }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    promiseValue(value) {
        this.pending = value;
    }
    /**
     * @private
     * @return {?}
     */
    notPromiseValue() { }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    booleanValue(value) {
        if (value) {
            this.pending = new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            resolve => {
                this.booleanValueResolveFn = resolve;
            }));
        }
        else if (this.booleanValueResolveFn) {
            this.booleanValueResolveFn();
        }
        else {
            this.stopLoading();
        }
    }
    /**
     * @private
     * @return {?}
     */
    notBooleanValue() {
        if (this.booleanValueResolveFn) {
            this.booleanValueResolveFn();
        }
    }
}
IsLoadingDirective.decorators = [
    { type: Directive, args: [{
                selector: '[swIsLoading]',
                exportAs: 'swIsLoading',
            },] }
];
/** @nocollapse */
IsLoadingDirective.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [SW_IS_LOADING_DIRECTIVE_CONFIG,] }] },
    { type: Renderer2 },
    { type: IsLoadingService },
    { type: ElementRef },
    { type: ComponentFactoryResolver },
    { type: Injector }
];
IsLoadingDirective.propDecorators = {
    swIsLoading: [{ type: Input }],
    swIsLoadingDisableEl: [{ type: Input }],
    swIsLoadingSpinner: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._isLoading;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.spinnerEl;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.config;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._swIsLoadingDisableEl;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._swIsLoadingSpinner;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.loadingClass;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.textValueSubscription;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.booleanValueResolveFn;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.isLoadingService;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.injector;
}
/**
 * @param {?} val
 * @return {?}
 */
function coerceBooleanValue(val) {
    if (typeof val === 'boolean')
        return val;
    if (['', 'true'].includes(val))
        return true;
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXMtbG9hZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac2VydmljZS13b3JrL2lzLWxvYWRpbmcvIiwic291cmNlcyI6WyJsaWIvbW9kdWxlL2RpcmVjdGl2ZS9pcy1sb2FkaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFHVix3QkFBd0IsRUFJeEIsUUFBUSxFQUNSLE1BQU0sRUFDTixRQUFRLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0UsT0FBTyxFQUNMLDhCQUE4QixHQUUvQixNQUFNLCtCQUErQixDQUFDOzs7QUFTdkMsTUFBTSxPQUFPLGtCQUFrQjs7Ozs7Ozs7O0lBaUY3QixZQUdFLE1BQTBDLEVBQ2xDLFFBQW1CLEVBQ25CLGdCQUFrQyxFQUNsQyxFQUEyQixFQUMzQix3QkFBa0QsRUFDbEQsUUFBa0I7UUFKbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLE9BQUUsR0FBRixFQUFFLENBQXlCO1FBQzNCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQW5DcEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUluQixXQUFNLEdBQWdDLEVBQUUsQ0FBQztRQUV6QywwQkFBcUIsR0FDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FB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LFdBQVcsRUFBRSxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxlQUFlO1FBQ3JCLElBQUksSUFBSSxDQUFDLHFCQUFxQixFQUFFO1lBQzlCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1NBQzlCO0lBQ0gsQ0FBQzs7O1lBcFBGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsZUFBZTtnQkFDekIsUUFBUSxFQUFFLGFBQWE7YUFDeEI7Ozs7NENBbUZJLFFBQVEsWUFDUixNQUFNLFNBQUMsOEJBQThCO1lBOUd4QyxTQUFTO1lBYUYsZ0JBQWdCO1lBWnZCLFVBQVU7WUFHVix3QkFBd0I7WUFJeEIsUUFBUTs7OzBCQW9CUCxLQUFLO21DQWlDTCxLQUFLO2lDQVNMLEtBQUs7Ozs7Ozs7SUFXTix3Q0FBMkI7Ozs7O0lBRTNCLHVDQUE0RDs7Ozs7SUFFNUQsb0NBQWlEOzs7OztJQUVqRCxtREFDcUU7Ozs7O0lBRXJFLGlEQUl5RDs7Ozs7SUFFekQsMENBRW9COzs7OztJQU9wQixtREFBNkM7Ozs7O0lBQzdDLG1EQUEyQzs7Ozs7SUFNekMsc0NBQTJCOzs7OztJQUMzQiw4Q0FBMEM7Ozs7O0lBQzFDLGdDQUFtQzs7Ozs7SUFDbkMsc0RBQTBEOzs7OztJQUMxRCxzQ0FBMEI7Ozs7OztBQTBKOUIsU0FBUyxrQkFBa0IsQ0FBQyxHQUFxQjtJQUMvQyxJQUFJLE9BQU8sR0FBRyxLQUFLLFNBQVM7UUFBRSxPQUFPLEdBQUcsQ0FBQztJQUN6QyxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUM7UUFBRSxPQUFPLElBQUksQ0FBQztJQUM1QyxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIElucHV0LFxuICBSZW5kZXJlcjIsXG4gIEVsZW1lbnRSZWYsXG4gIE9uRGVzdHJveSxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBTaW1wbGVDaGFuZ2UsXG4gIE9uQ2hhbmdlcyxcbiAgQ29tcG9uZW50UmVmLFxuICBJbmplY3RvcixcbiAgSW5qZWN0LFxuICBPcHRpb25hbCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElzTG9hZGluZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9pcy1sb2FkaW5nLnNlcnZpY2UnO1xuaW1wb3J0IHsgSXNMb2FkaW5nU3Bpbm5lckNvbXBvbmVudCB9IGZyb20gJy4vaXMtbG9hZGluZy1zcGlubmVyLmNvbXBvbmVudCc7XG5pbXBvcnQge1xuICBTV19JU19MT0FESU5HX0RJUkVDVElWRV9DT05GSUcsXG4gIElTV0lzTG9hZGluZ0RpcmVjdGl2ZUNvbmZpZyxcbn0gZnJvbSAnLi9pcy1sb2FkaW5nLmRpcmVjdGl2ZS5jb25maWcnO1xuXG4vLyBUaGlzIGNvZGUgd2FzIGluc3BpcmVkIGJ5IGFuZ3VsYXIyLXByb21pc2UtYnV0dG9uc1xuLy8gaHR0cHM6Ly9naXRodWIuY29tL2pvaGFubmVzam8vYW5ndWxhcjItcHJvbWlzZS1idXR0b25zXG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tzd0lzTG9hZGluZ10nLFxuICBleHBvcnRBczogJ3N3SXNMb2FkaW5nJyxcbn0pXG5leHBvcnQgY2xhc3MgSXNMb2FkaW5nRGlyZWN0aXZlIGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKVxuICBzZXQgc3dJc0xvYWRpbmcodmFsdWU6IHVua25vd24pIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5zdHJpbmdWYWx1ZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm90U3RyaW5nVmFsdWUoKTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9uVmFsdWUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5vdFN1YnNjcmlwdGlvblZhbHVlKCk7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xuICAgICAgdGhpcy5wcm9taXNlVmFsdWUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5vdFByb21pc2VWYWx1ZSgpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgdGhpcy5ib29sZWFuVmFsdWUodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5vdEJvb2xlYW5WYWx1ZSgpO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9ic2VydmFibGUpIHtcbiAgICAgIHRoaXMub2JzZXJ2YWJsZVZhbHVlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm90T2JzZXJ2YWJsZVZhbHVlKCk7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KCkgc2V0IHN3SXNMb2FkaW5nRGlzYWJsZUVsKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc3dJc0xvYWRpbmdEaXNhYmxlRWwgPSBjb2VyY2VCb29sZWFuVmFsdWUodmFsdWUpO1xuICB9XG4gIGdldCBzd0lzTG9hZGluZ0Rpc2FibGVFbCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc3dJc0xvYWRpbmdEaXNhYmxlRWw7XG4gIH1cblxuICAvLyBCeSBkZWZhdWx0LCBpZiB0aGlzIGRpcmVjdGl2ZSBpcyBhdHRhY2hlZCB0byBhbiBhbmNob3Igb3IgYSBidXR0b25cbiAgLy8gZWxlbWVudCwgYWRkIGEgYHN3LWlzLWxvYWRpbmctc3Bpbm5lcmAgZWxlbWVudCB0byB0aGUgZG9tIChmb3Igc3R5bGluZylcbiAgQElucHV0KCkgc2V0IHN3SXNMb2FkaW5nU3Bpbm5lcih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX3N3SXNMb2FkaW5nU3Bpbm5lciA9IGNvZXJjZUJvb2xlYW5WYWx1ZSh2YWx1ZSk7XG4gIH1cbiAgZ2V0IHN3SXNMb2FkaW5nU3Bpbm5lcigpIHtcbiAgICByZXR1cm4gdGhpcy5fc3dJc0xvYWRpbmdTcGlubmVyO1xuICB9XG5cbiAgZ2V0IGlzTG9hZGluZygpIHtcbiAgICByZXR1cm4gdGhpcy5faXNMb2FkaW5nO1xuICB9XG5cbiAgcHJpdmF0ZSBfaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBzcGlubmVyRWw/OiBDb21wb25lbnRSZWY8SXNMb2FkaW5nU3Bpbm5lckNvbXBvbmVudD47XG5cbiAgcHJpdmF0ZSBjb25maWc6IElTV0lzTG9hZGluZ0RpcmVjdGl2ZUNvbmZpZyA9IHt9O1xuXG4gIHByaXZhdGUgX3N3SXNMb2FkaW5nRGlzYWJsZUVsID1cbiAgICB0aGlzLmNvbmZpZy5kaXNhYmxlRWwgPT09IHVuZGVmaW5lZCA/IHRydWUgOiB0aGlzLmNvbmZpZy5kaXNhYmxlRWw7XG5cbiAgcHJpdmF0ZSBfc3dJc0xvYWRpbmdTcGlubmVyID1cbiAgICB0aGlzLmNvbmZpZy5hZGRTcGlubmVyRWwgIT09IHVuZGVmaW5lZFxuICAgICAgPyB0aGlzLmNvbmZpZy5hZGRTcGlubmVyRWxcbiAgICAgIDogdGhpcy5lbC5uYXRpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTEJ1dHRvbkVsZW1lbnQgfHxcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTEFuY2hvckVsZW1lbnQ7XG5cbiAgcHJpdmF0ZSBsb2FkaW5nQ2xhc3MgPSB0aGlzLmNvbmZpZy5sb2FkaW5nQ2xhc3NcbiAgICA/IHRoaXMuY29uZmlnLmxvYWRpbmdDbGFzc1xuICAgIDogJ3N3LWlzLWxvYWRpbmcnO1xuXG4gIHByaXZhdGUgc2V0IHBlbmRpbmcodmFsdWU6IFByb21pc2U8dW5rbm93bj4pIHtcbiAgICB0aGlzLnN0YXJ0TG9hZGluZygpO1xuICAgIHZhbHVlLmZpbmFsbHkoKCkgPT4gdGhpcy5zdG9wTG9hZGluZygpKTtcbiAgfVxuXG4gIHByaXZhdGUgdGV4dFZhbHVlU3Vic2NyaXB0aW9uPzogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGJvb2xlYW5WYWx1ZVJlc29sdmVGbj86ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQE9wdGlvbmFsKClcbiAgICBASW5qZWN0KFNXX0lTX0xPQURJTkdfRElSRUNUSVZFX0NPTkZJRylcbiAgICBjb25maWc6IElTV0lzTG9hZGluZ0RpcmVjdGl2ZUNvbmZpZyB8IG51bGwsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgaXNMb2FkaW5nU2VydmljZTogSXNMb2FkaW5nU2VydmljZSxcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PixcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICApIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IHtcbiAgICBzd0lzTG9hZGluZ1NwaW5uZXI/OiBTaW1wbGVDaGFuZ2U7XG4gICAgc3dJc0xvYWRpbmdEaXNhYmxlRWw/OiBTaW1wbGVDaGFuZ2U7XG4gIH0pIHtcbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLnN3SXNMb2FkaW5nU3Bpbm5lciAmJlxuICAgICAgIWNoYW5nZXMuc3dJc0xvYWRpbmdTcGlubmVyLmlzRmlyc3RDaGFuZ2UoKSAmJlxuICAgICAgIWNoYW5nZXMuc3dJc0xvYWRpbmdTcGlubmVyLmN1cnJlbnRWYWx1ZVxuICAgICkge1xuICAgICAgdGhpcy5yZW1vdmVTcGlubmVyRWwoKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBjaGFuZ2VzLnN3SXNMb2FkaW5nRGlzYWJsZUVsICYmXG4gICAgICAhY2hhbmdlcy5zd0lzTG9hZGluZ0Rpc2FibGVFbC5pc0ZpcnN0Q2hhbmdlKCkgJiZcbiAgICAgICFjaGFuZ2VzLnN3SXNMb2FkaW5nRGlzYWJsZUVsLmN1cnJlbnRWYWx1ZVxuICAgICkge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKHRoaXMuc3dJc0xvYWRpbmdTcGlubmVyKSB7XG4gICAgICB0aGlzLmFkZFNwaW5uZXJFbCgpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50ZXh0VmFsdWVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0TG9hZGluZygpIHtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgdGhpcy5sb2FkaW5nQ2xhc3MpO1xuICAgIGlmICh0aGlzLnN3SXNMb2FkaW5nRGlzYWJsZUVsKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgIH1cbiAgICB0aGlzLl9pc0xvYWRpbmcgPSB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBzdG9wTG9hZGluZygpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgdGhpcy5sb2FkaW5nQ2xhc3MpO1xuICAgIGlmICh0aGlzLnN3SXNMb2FkaW5nRGlzYWJsZUVsKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcpO1xuICAgIH1cbiAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkU3Bpbm5lckVsKCkge1xuICAgIHRoaXMuc3Bpbm5lckVsID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXJcbiAgICAgIC5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShJc0xvYWRpbmdTcGlubmVyQ29tcG9uZW50KVxuICAgICAgLmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcblxuICAgIC8vIG5lZWQgdG8gdXNlIFJlbmRlcmVyMiNhcHBlbmRDaGlsZCBpbnN0ZWFkIG9mXG4gICAgLy8gVmlld0NvbnRhaW5lclJlZiNjcmVhdGVDb21wb25lbnQgYmVjYXVzZSB0aGUgaW5qZWN0ZWRcbiAgICAvLyB2aWV3IGNvbnRhaW5lciBpcyBub3QgZm9yIHRoZSBlbGVtZW50IHRoaXMgZGlyZWN0aXZlXG4gICAgLy8gaXMgYXBwbGllZCB0b1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoXG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXG4gICAgICB0aGlzLnNwaW5uZXJFbC5pbnN0YW5jZS5lbC5uYXRpdmVFbGVtZW50LFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVNwaW5uZXJFbCgpIHtcbiAgICBpZiAoIXRoaXMuc3Bpbm5lckVsKSByZXR1cm47XG5cbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKFxuICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LFxuICAgICAgdGhpcy5zcGlubmVyRWwuaW5zdGFuY2UuZWwubmF0aXZlRWxlbWVudCxcbiAgICApO1xuXG4gICAgdGhpcy5zcGlubmVyRWwuZGVzdHJveSgpO1xuICAgIHRoaXMuc3Bpbm5lckVsID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIElucHV0IHZhbHVlIGhhbmRsZXJzXG4gICAqL1xuXG4gIHByaXZhdGUgc3RyaW5nVmFsdWUodmFsdWU6IHN0cmluZykge1xuICAgIGlmICh0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50ZXh0VmFsdWVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBsZXQgb2JzOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgb2JzID0gdGhpcy5pc0xvYWRpbmdTZXJ2aWNlLmlzTG9hZGluZyQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JzID0gdGhpcy5pc0xvYWRpbmdTZXJ2aWNlLmlzTG9hZGluZyQoe1xuICAgICAgICBrZXk6IHZhbHVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy50ZXh0VmFsdWVTdWJzY3JpcHRpb24gPSBvYnMuc3Vic2NyaWJlKGxvYWRpbmcgPT4ge1xuICAgICAgaWYgKGxvYWRpbmcpIHtcbiAgICAgICAgdGhpcy5zdGFydExvYWRpbmcoKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0xvYWRpbmcpIHtcbiAgICAgICAgdGhpcy5zdG9wTG9hZGluZygpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBub3RTdHJpbmdWYWx1ZSgpIHtcbiAgICBpZiAodGhpcy50ZXh0VmFsdWVTdWJzY3JpcHRpb24pIHtcbiAgICAgIHRoaXMudGV4dFZhbHVlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvYnNlcnZhYmxlVmFsdWUoKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICdzd0J0blBlbmRpbmcgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBTdWJzY3JpcHRpb24sIGluc3RhbmNlIG9mIE9ic2VydmFibGUgZ2l2ZW4nLFxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIG5vdE9ic2VydmFibGVWYWx1ZSgpIHt9XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25WYWx1ZSh2YWx1ZTogU3Vic2NyaXB0aW9uKSB7XG4gICAgdGhpcy5wZW5kaW5nID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB2YWx1ZS5hZGQocmVzb2x2ZSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBub3RTdWJzY3JpcHRpb25WYWx1ZSgpIHt9XG5cbiAgcHJpdmF0ZSBwcm9taXNlVmFsdWUodmFsdWU6IFByb21pc2U8dW5rbm93bj4pIHtcbiAgICB0aGlzLnBlbmRpbmcgPSB2YWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgbm90UHJvbWlzZVZhbHVlKCkge31cblxuICBwcml2YXRlIGJvb2xlYW5WYWx1ZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5wZW5kaW5nID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIHRoaXMuYm9vbGVhblZhbHVlUmVzb2x2ZUZuID0gcmVzb2x2ZTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodGhpcy5ib29sZWFuVmFsdWVSZXNvbHZlRm4pIHtcbiAgICAgIHRoaXMuYm9vbGVhblZhbHVlUmVzb2x2ZUZuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RvcExvYWRpbmcoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG5vdEJvb2xlYW5WYWx1ZSgpIHtcbiAgICBpZiAodGhpcy5ib29sZWFuVmFsdWVSZXNvbHZlRm4pIHtcbiAgICAgIHRoaXMuYm9vbGVhblZhbHVlUmVzb2x2ZUZuKCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvZXJjZUJvb2xlYW5WYWx1ZSh2YWw6IHN0cmluZyB8IGJvb2xlYW4pIHtcbiAgaWYgKHR5cGVvZiB2YWwgPT09ICdib29sZWFuJykgcmV0dXJuIHZhbDtcbiAgaWYgKFsnJywgJ3RydWUnXS5pbmNsdWRlcyh2YWwpKSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGZhbHNlO1xufVxuIl19
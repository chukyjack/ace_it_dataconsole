/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, Renderer2, ElementRef, ComponentFactoryResolver, Injector, Inject, Optional, } from '@angular/core';
import { Observable, Subscription } from 'rxjs';
import { IsLoadingService } from '../../is-loading.service';
import { IsLoadingSpinnerComponent } from './is-loading-spinner.component';
import { SW_IS_LOADING_DIRECTIVE_CONFIG, } from './is-loading.directive.config';
// This code was inspired by angular2-promise-buttons
// https://github.com/johannesjo/angular2-promise-buttons
var IsLoadingDirective = /** @class */ (function () {
    function IsLoadingDirective(config, renderer, isLoadingService, el, componentFactoryResolver, injector) {
        this.renderer = renderer;
        this.isLoadingService = isLoadingService;
        this.el = el;
        this.componentFactoryResolver = componentFactoryResolver;
        this.injector = injector;
        this._isLoading = false;
        this.config = {};
        this._swIsLoadingDisableEl = this.config.disableEl === undefined ? true : this.config.disableEl;
        this._swIsLoadingSpinner = this.config.addSpinnerEl !== undefined
            ? this.config.addSpinnerEl
            : this.el.nativeElement instanceof HTMLButtonElement ||
                this.el.nativeElement instanceof HTMLAnchorElement;
        this.loadingClass = this.config.loadingClass
            ? this.config.loadingClass
            : 'sw-is-loading';
        this.config = config || {};
    }
    Object.defineProperty(IsLoadingDirective.prototype, "swIsLoading", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (typeof value === 'string') {
                this.stringValue(value);
            }
            else {
                this.notStringValue();
            }
            if (value instanceof Subscription) {
                this.subscriptionValue(value);
            }
            else {
                this.notSubscriptionValue();
            }
            if (value instanceof Promise) {
                this.promiseValue(value);
            }
            else {
                this.notPromiseValue();
            }
            if (typeof value === 'boolean') {
                this.booleanValue(value);
            }
            else {
                this.notBooleanValue();
            }
            if (value instanceof Observable) {
                this.observableValue();
            }
            else {
                this.notObservableValue();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IsLoadingDirective.prototype, "swIsLoadingDisableEl", {
        get: /**
         * @return {?}
         */
        function () {
            return this._swIsLoadingDisableEl;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._swIsLoadingDisableEl = coerceBooleanValue(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IsLoadingDirective.prototype, "swIsLoadingSpinner", {
        get: /**
         * @return {?}
         */
        function () {
            return this._swIsLoadingSpinner;
        },
        // By default, if this directive is attached to an anchor or a button
        // element, add a `sw-is-loading-spinner` element to the dom (for styling)
        set: 
        // By default, if this directive is attached to an anchor or a button
        // element, add a `sw-is-loading-spinner` element to the dom (for styling)
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._swIsLoadingSpinner = coerceBooleanValue(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IsLoadingDirective.prototype, "isLoading", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isLoading;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(IsLoadingDirective.prototype, "pending", {
        set: /**
         * @private
         * @param {?} value
         * @return {?}
         */
        function (value) {
            var _this = this;
            this.startLoading();
            value.finally((/**
             * @return {?}
             */
            function () { return _this.stopLoading(); }));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} changes
     * @return {?}
     */
    IsLoadingDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.swIsLoadingSpinner &&
            !changes.swIsLoadingSpinner.isFirstChange() &&
            !changes.swIsLoadingSpinner.currentValue) {
            this.removeSpinnerEl();
        }
        if (changes.swIsLoadingDisableEl &&
            !changes.swIsLoadingDisableEl.isFirstChange() &&
            !changes.swIsLoadingDisableEl.currentValue) {
            this.renderer.removeAttribute(this.el.nativeElement, 'disabled');
        }
    };
    /**
     * @return {?}
     */
    IsLoadingDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        if (this.swIsLoadingSpinner) {
            this.addSpinnerEl();
        }
    };
    /**
     * @return {?}
     */
    IsLoadingDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.startLoading = /**
     * @private
     * @return {?}
     */
    function () {
        this.renderer.addClass(this.el.nativeElement, this.loadingClass);
        if (this.swIsLoadingDisableEl) {
            this.renderer.setAttribute(this.el.nativeElement, 'disabled', 'disabled');
        }
        this._isLoading = true;
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.stopLoading = /**
     * @private
     * @return {?}
     */
    function () {
        this.renderer.removeClass(this.el.nativeElement, this.loadingClass);
        if (this.swIsLoadingDisableEl) {
            this.renderer.removeAttribute(this.el.nativeElement, 'disabled');
        }
        this._isLoading = false;
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.addSpinnerEl = /**
     * @private
     * @return {?}
     */
    function () {
        this.spinnerEl = this.componentFactoryResolver
            .resolveComponentFactory(IsLoadingSpinnerComponent)
            .create(this.injector);
        // need to use Renderer2#appendChild instead of
        // ViewContainerRef#createComponent because the injected
        // view container is not for the element this directive
        // is applied to
        this.renderer.appendChild(this.el.nativeElement, this.spinnerEl.instance.el.nativeElement);
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.removeSpinnerEl = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.spinnerEl)
            return;
        this.renderer.removeChild(this.el.nativeElement, this.spinnerEl.instance.el.nativeElement);
        this.spinnerEl.destroy();
        this.spinnerEl = undefined;
    };
    /**
     * Input value handlers
     */
    /**
     * Input value handlers
     * @private
     * @param {?} value
     * @return {?}
     */
    IsLoadingDirective.prototype.stringValue = /**
     * Input value handlers
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
        /** @type {?} */
        var obs;
        if (!value) {
            obs = this.isLoadingService.isLoading$();
        }
        else {
            obs = this.isLoadingService.isLoading$({
                key: value,
            });
        }
        this.textValueSubscription = obs.subscribe((/**
         * @param {?} loading
         * @return {?}
         */
        function (loading) {
            if (loading) {
                _this.startLoading();
            }
            else if (_this.isLoading) {
                _this.stopLoading();
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.notStringValue = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.textValueSubscription) {
            this.textValueSubscription.unsubscribe();
        }
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.observableValue = /**
     * @private
     * @return {?}
     */
    function () {
        throw new TypeError('swBtnPending must be an instance of Subscription, instance of Observable given');
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.notObservableValue = /**
     * @private
     * @return {?}
     */
    function () { };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    IsLoadingDirective.prototype.subscriptionValue = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.pending = new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) { return value.add(resolve); }));
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.notSubscriptionValue = /**
     * @private
     * @return {?}
     */
    function () { };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    IsLoadingDirective.prototype.promiseValue = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.pending = value;
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.notPromiseValue = /**
     * @private
     * @return {?}
     */
    function () { };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    IsLoadingDirective.prototype.booleanValue = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        if (value) {
            this.pending = new Promise((/**
             * @param {?} resolve
             * @return {?}
             */
            function (resolve) {
                _this.booleanValueResolveFn = resolve;
            }));
        }
        else if (this.booleanValueResolveFn) {
            this.booleanValueResolveFn();
        }
        else {
            this.stopLoading();
        }
    };
    /**
     * @private
     * @return {?}
     */
    IsLoadingDirective.prototype.notBooleanValue = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.booleanValueResolveFn) {
            this.booleanValueResolveFn();
        }
    };
    IsLoadingDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[swIsLoading]',
                    exportAs: 'swIsLoading',
                },] }
    ];
    /** @nocollapse */
    IsLoadingDirective.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [SW_IS_LOADING_DIRECTIVE_CONFIG,] }] },
        { type: Renderer2 },
        { type: IsLoadingService },
        { type: ElementRef },
        { type: ComponentFactoryResolver },
        { type: Injector }
    ]; };
    IsLoadingDirective.propDecorators = {
        swIsLoading: [{ type: Input }],
        swIsLoadingDisableEl: [{ type: Input }],
        swIsLoadingSpinner: [{ type: Input }]
    };
    return IsLoadingDirective;
}());
export { IsLoadingDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._isLoading;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.spinnerEl;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.config;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._swIsLoadingDisableEl;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype._swIsLoadingSpinner;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.loadingClass;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.textValueSubscription;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.booleanValueResolveFn;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.isLoadingService;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.el;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    IsLoadingDirective.prototype.injector;
}
/**
 * @param {?} val
 * @return {?}
 */
function coerceBooleanValue(val) {
    if (typeof val === 'boolean')
        return val;
    if (['', 'true'].includes(val))
        return true;
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXMtbG9hZGluZy5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac2VydmljZS13b3JrL2lzLWxvYWRpbmcvIiwic291cmNlcyI6WyJsaWIvbW9kdWxlL2RpcmVjdGl2ZS9pcy1sb2FkaW5nLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFHVix3QkFBd0IsRUFJeEIsUUFBUSxFQUNSLE1BQU0sRUFDTixRQUFRLEdBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDNUQsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0UsT0FBTyxFQUNMLDhCQUE4QixHQUUvQixNQUFNLCtCQUErQixDQUFDOzs7QUFLdkM7SUFxRkUsNEJBR0UsTUFBMEMsRUFDbEMsUUFBbUIsRUFDbkIsZ0JBQWtDLEVBQ2xDLEVBQTJCLEVBQzNCLHdCQUFrRCxFQUNsRCxRQUFrQjtRQUpsQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsT0FBRSxHQUFGLEVBQUUsQ0FBeUI7UUFDM0IsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBbkNwQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBSW5CLFdBQU0sR0FBZ0MsRUFBRSxDQUFDO1FBRXpDLDBCQUFxQixHQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7UUFFN0Qsd0JBQW1CLEdBQ3pC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QUFTLGtCQUFrQixDQUFDLEdBQXFCO0lBQy9DLElBQUksT0FBTyxHQUFHLEtBQUssU0FBUztRQUFFLE9BQU8sR0FBRyxDQUFDO0lBQ3pDLElBQUksQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztRQUFFLE9BQU8sSUFBSSxDQUFDO0lBQzVDLE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgSW5wdXQsXG4gIFJlbmRlcmVyMixcbiAgRWxlbWVudFJlZixcbiAgT25EZXN0cm95LFxuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIFNpbXBsZUNoYW5nZSxcbiAgT25DaGFuZ2VzLFxuICBDb21wb25lbnRSZWYsXG4gIEluamVjdG9yLFxuICBJbmplY3QsXG4gIE9wdGlvbmFsLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSXNMb2FkaW5nU2VydmljZSB9IGZyb20gJy4uLy4uL2lzLWxvYWRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBJc0xvYWRpbmdTcGlubmVyQ29tcG9uZW50IH0gZnJvbSAnLi9pcy1sb2FkaW5nLXNwaW5uZXIuY29tcG9uZW50JztcbmltcG9ydCB7XG4gIFNXX0lTX0xPQURJTkdfRElSRUNUSVZFX0NPTkZJRyxcbiAgSVNXSXNMb2FkaW5nRGlyZWN0aXZlQ29uZmlnLFxufSBmcm9tICcuL2lzLWxvYWRpbmcuZGlyZWN0aXZlLmNvbmZpZyc7XG5cbi8vIFRoaXMgY29kZSB3YXMgaW5zcGlyZWQgYnkgYW5ndWxhcjItcHJvbWlzZS1idXR0b25zXG4vLyBodHRwczovL2dpdGh1Yi5jb20vam9oYW5uZXNqby9hbmd1bGFyMi1wcm9taXNlLWJ1dHRvbnNcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3N3SXNMb2FkaW5nXScsXG4gIGV4cG9ydEFzOiAnc3dJc0xvYWRpbmcnLFxufSlcbmV4cG9ydCBjbGFzcyBJc0xvYWRpbmdEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpXG4gIHNldCBzd0lzTG9hZGluZyh2YWx1ZTogdW5rbm93bikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLnN0cmluZ1ZhbHVlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ub3RTdHJpbmdWYWx1ZSgpO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb25WYWx1ZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm90U3Vic2NyaXB0aW9uVmFsdWUoKTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICB0aGlzLnByb21pc2VWYWx1ZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm90UHJvbWlzZVZhbHVlKCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICB0aGlzLmJvb2xlYW5WYWx1ZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm90Qm9vbGVhblZhbHVlKCk7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkge1xuICAgICAgdGhpcy5vYnNlcnZhYmxlVmFsdWUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5ub3RPYnNlcnZhYmxlVmFsdWUoKTtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKSBzZXQgc3dJc0xvYWRpbmdEaXNhYmxlRWwodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9zd0lzTG9hZGluZ0Rpc2FibGVFbCA9IGNvZXJjZUJvb2xlYW5WYWx1ZSh2YWx1ZSk7XG4gIH1cbiAgZ2V0IHN3SXNMb2FkaW5nRGlzYWJsZUVsKCkge1xuICAgIHJldHVybiB0aGlzLl9zd0lzTG9hZGluZ0Rpc2FibGVFbDtcbiAgfVxuXG4gIC8vIEJ5IGRlZmF1bHQsIGlmIHRoaXMgZGlyZWN0aXZlIGlzIGF0dGFjaGVkIHRvIGFuIGFuY2hvciBvciBhIGJ1dHRvblxuICAvLyBlbGVtZW50LCBhZGQgYSBgc3ctaXMtbG9hZGluZy1zcGlubmVyYCBlbGVtZW50IHRvIHRoZSBkb20gKGZvciBzdHlsaW5nKVxuICBASW5wdXQoKSBzZXQgc3dJc0xvYWRpbmdTcGlubmVyKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fc3dJc0xvYWRpbmdTcGlubmVyID0gY29lcmNlQm9vbGVhblZhbHVlKHZhbHVlKTtcbiAgfVxuICBnZXQgc3dJc0xvYWRpbmdTcGlubmVyKCkge1xuICAgIHJldHVybiB0aGlzLl9zd0lzTG9hZGluZ1NwaW5uZXI7XG4gIH1cblxuICBnZXQgaXNMb2FkaW5nKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0xvYWRpbmc7XG4gIH1cblxuICBwcml2YXRlIF9pc0xvYWRpbmcgPSBmYWxzZTtcblxuICBwcml2YXRlIHNwaW5uZXJFbD86IENvbXBvbmVudFJlZjxJc0xvYWRpbmdTcGlubmVyQ29tcG9uZW50PjtcblxuICBwcml2YXRlIGNvbmZpZzogSVNXSXNMb2FkaW5nRGlyZWN0aXZlQ29uZmlnID0ge307XG5cbiAgcHJpdmF0ZSBfc3dJc0xvYWRpbmdEaXNhYmxlRWwgPVxuICAgIHRoaXMuY29uZmlnLmRpc2FibGVFbCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IHRoaXMuY29uZmlnLmRpc2FibGVFbDtcblxuICBwcml2YXRlIF9zd0lzTG9hZGluZ1NwaW5uZXIgPVxuICAgIHRoaXMuY29uZmlnLmFkZFNwaW5uZXJFbCAhPT0gdW5kZWZpbmVkXG4gICAgICA/IHRoaXMuY29uZmlnLmFkZFNwaW5uZXJFbFxuICAgICAgOiB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MQnV0dG9uRWxlbWVudCB8fFxuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MQW5jaG9yRWxlbWVudDtcblxuICBwcml2YXRlIGxvYWRpbmdDbGFzcyA9IHRoaXMuY29uZmlnLmxvYWRpbmdDbGFzc1xuICAgID8gdGhpcy5jb25maWcubG9hZGluZ0NsYXNzXG4gICAgOiAnc3ctaXMtbG9hZGluZyc7XG5cbiAgcHJpdmF0ZSBzZXQgcGVuZGluZyh2YWx1ZTogUHJvbWlzZTx1bmtub3duPikge1xuICAgIHRoaXMuc3RhcnRMb2FkaW5nKCk7XG4gICAgdmFsdWUuZmluYWxseSgoKSA9PiB0aGlzLnN0b3BMb2FkaW5nKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSB0ZXh0VmFsdWVTdWJzY3JpcHRpb24/OiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgYm9vbGVhblZhbHVlUmVzb2x2ZUZuPzogKCkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBAT3B0aW9uYWwoKVxuICAgIEBJbmplY3QoU1dfSVNfTE9BRElOR19ESVJFQ1RJVkVfQ09ORklHKVxuICAgIGNvbmZpZzogSVNXSXNMb2FkaW5nRGlyZWN0aXZlQ29uZmlnIHwgbnVsbCxcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSBpc0xvYWRpbmdTZXJ2aWNlOiBJc0xvYWRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczoge1xuICAgIHN3SXNMb2FkaW5nU3Bpbm5lcj86IFNpbXBsZUNoYW5nZTtcbiAgICBzd0lzTG9hZGluZ0Rpc2FibGVFbD86IFNpbXBsZUNoYW5nZTtcbiAgfSkge1xuICAgIGlmIChcbiAgICAgIGNoYW5nZXMuc3dJc0xvYWRpbmdTcGlubmVyICYmXG4gICAgICAhY2hhbmdlcy5zd0lzTG9hZGluZ1NwaW5uZXIuaXNGaXJzdENoYW5nZSgpICYmXG4gICAgICAhY2hhbmdlcy5zd0lzTG9hZGluZ1NwaW5uZXIuY3VycmVudFZhbHVlXG4gICAgKSB7XG4gICAgICB0aGlzLnJlbW92ZVNwaW5uZXJFbCgpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGNoYW5nZXMuc3dJc0xvYWRpbmdEaXNhYmxlRWwgJiZcbiAgICAgICFjaGFuZ2VzLnN3SXNMb2FkaW5nRGlzYWJsZUVsLmlzRmlyc3RDaGFuZ2UoKSAmJlxuICAgICAgIWNoYW5nZXMuc3dJc0xvYWRpbmdEaXNhYmxlRWwuY3VycmVudFZhbHVlXG4gICAgKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAodGhpcy5zd0lzTG9hZGluZ1NwaW5uZXIpIHtcbiAgICAgIHRoaXMuYWRkU3Bpbm5lckVsKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMudGV4dFZhbHVlU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRMb2FkaW5nKCkge1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCB0aGlzLmxvYWRpbmdDbGFzcyk7XG4gICAgaWYgKHRoaXMuc3dJc0xvYWRpbmdEaXNhYmxlRWwpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgfVxuICAgIHRoaXMuX2lzTG9hZGluZyA9IHRydWU7XG4gIH1cblxuICBwcml2YXRlIHN0b3BMb2FkaW5nKCkge1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy5lbC5uYXRpdmVFbGVtZW50LCB0aGlzLmxvYWRpbmdDbGFzcyk7XG4gICAgaWYgKHRoaXMuc3dJc0xvYWRpbmdEaXNhYmxlRWwpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2Rpc2FibGVkJyk7XG4gICAgfVxuICAgIHRoaXMuX2lzTG9hZGluZyA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRTcGlubmVyRWwoKSB7XG4gICAgdGhpcy5zcGlubmVyRWwgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICAgICAgLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KElzTG9hZGluZ1NwaW5uZXJDb21wb25lbnQpXG4gICAgICAuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xuXG4gICAgLy8gbmVlZCB0byB1c2UgUmVuZGVyZXIyI2FwcGVuZENoaWxkIGluc3RlYWQgb2ZcbiAgICAvLyBWaWV3Q29udGFpbmVyUmVmI2NyZWF0ZUNvbXBvbmVudCBiZWNhdXNlIHRoZSBpbmplY3RlZFxuICAgIC8vIHZpZXcgY29udGFpbmVyIGlzIG5vdCBmb3IgdGhlIGVsZW1lbnQgdGhpcyBkaXJlY3RpdmVcbiAgICAvLyBpcyBhcHBsaWVkIHRvXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChcbiAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudCxcbiAgICAgIHRoaXMuc3Bpbm5lckVsLmluc3RhbmNlLmVsLm5hdGl2ZUVsZW1lbnQsXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlU3Bpbm5lckVsKCkge1xuICAgIGlmICghdGhpcy5zcGlubmVyRWwpIHJldHVybjtcblxuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2hpbGQoXG4gICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsXG4gICAgICB0aGlzLnNwaW5uZXJFbC5pbnN0YW5jZS5lbC5uYXRpdmVFbGVtZW50LFxuICAgICk7XG5cbiAgICB0aGlzLnNwaW5uZXJFbC5kZXN0cm95KCk7XG4gICAgdGhpcy5zcGlubmVyRWwgPSB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogSW5wdXQgdmFsdWUgaGFuZGxlcnNcbiAgICovXG5cbiAgcHJpdmF0ZSBzdHJpbmdWYWx1ZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMudGV4dFZhbHVlU3Vic2NyaXB0aW9uKSB7XG4gICAgICB0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGxldCBvYnM6IE9ic2VydmFibGU8Ym9vbGVhbj47XG5cbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICBvYnMgPSB0aGlzLmlzTG9hZGluZ1NlcnZpY2UuaXNMb2FkaW5nJCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYnMgPSB0aGlzLmlzTG9hZGluZ1NlcnZpY2UuaXNMb2FkaW5nJCh7XG4gICAgICAgIGtleTogdmFsdWUsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbiA9IG9icy5zdWJzY3JpYmUobG9hZGluZyA9PiB7XG4gICAgICBpZiAobG9hZGluZykge1xuICAgICAgICB0aGlzLnN0YXJ0TG9hZGluZygpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzTG9hZGluZykge1xuICAgICAgICB0aGlzLnN0b3BMb2FkaW5nKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG5vdFN0cmluZ1ZhbHVlKCkge1xuICAgIGlmICh0aGlzLnRleHRWYWx1ZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy50ZXh0VmFsdWVTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9ic2VydmFibGVWYWx1ZSgpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgJ3N3QnRuUGVuZGluZyBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIFN1YnNjcmlwdGlvbiwgaW5zdGFuY2Ugb2YgT2JzZXJ2YWJsZSBnaXZlbicsXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgbm90T2JzZXJ2YWJsZVZhbHVlKCkge31cblxuICBwcml2YXRlIHN1YnNjcmlwdGlvblZhbHVlKHZhbHVlOiBTdWJzY3JpcHRpb24pIHtcbiAgICB0aGlzLnBlbmRpbmcgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHZhbHVlLmFkZChyZXNvbHZlKSk7XG4gIH1cblxuICBwcml2YXRlIG5vdFN1YnNjcmlwdGlvblZhbHVlKCkge31cblxuICBwcml2YXRlIHByb21pc2VWYWx1ZSh2YWx1ZTogUHJvbWlzZTx1bmtub3duPikge1xuICAgIHRoaXMucGVuZGluZyA9IHZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBub3RQcm9taXNlVmFsdWUoKSB7fVxuXG4gIHByaXZhdGUgYm9vbGVhblZhbHVlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLnBlbmRpbmcgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgdGhpcy5ib29sZWFuVmFsdWVSZXNvbHZlRm4gPSByZXNvbHZlO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmJvb2xlYW5WYWx1ZVJlc29sdmVGbikge1xuICAgICAgdGhpcy5ib29sZWFuVmFsdWVSZXNvbHZlRm4oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdG9wTG9hZGluZygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbm90Qm9vbGVhblZhbHVlKCkge1xuICAgIGlmICh0aGlzLmJvb2xlYW5WYWx1ZVJlc29sdmVGbikge1xuICAgICAgdGhpcy5ib29sZWFuVmFsdWVSZXNvbHZlRm4oKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY29lcmNlQm9vbGVhblZhbHVlKHZhbDogc3RyaW5nIHwgYm9vbGVhbikge1xuICBpZiAodHlwZW9mIHZhbCA9PT0gJ2Jvb2xlYW4nKSByZXR1cm4gdmFsO1xuICBpZiAoWycnLCAndHJ1ZSddLmluY2x1ZGVzKHZhbCkpIHJldHVybiB0cnVlO1xuICByZXR1cm4gZmFsc2U7XG59XG4iXX0=
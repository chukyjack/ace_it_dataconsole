!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("@service-work/is-loading",["exports","rxjs/operators","rxjs","@angular/core"],t):t((e["service-work"]=e["service-work"]||{},e["service-work"]["is-loading"]={}),e.rxjs.operators,e.rxjs,e.ng.core)}(this,function(e,r,a,t){"use strict";var n=(i.prototype.isLoading$=function(e){var n=this;void 0===e&&(e={});var i=this.normalizeKeys(e.key);return new a.Observable(function(t){n.indexKeys(i);var e=n.loadingSubjects.get(i[0]).pipe(r.distinctUntilChanged(),r.debounceTime(10),r.distinctUntilChanged()).subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){t.complete()}});return function(){e.unsubscribe(),i.forEach(function(e){return n.deIndexKey(e)})}})},i.prototype.isLoading=function(e){void 0===e&&(e={});var t=this.normalizeKeys(e.key)[0],n=this.loadingSubjects.get(t);return n&&n.value||!1},i.prototype.add=function(e,t){var n,i,o=this;if(e instanceof a.Subscription){if(e.closed)return e;(i=e).add(function(){return o.remove(e,t)})}else if(e instanceof Promise)(i=e).then(function(){return o.remove(e,t)},function(){return o.remove(e,t)});else if(e instanceof a.Observable){if((i=e.pipe(r.take(1)).subscribe()).closed)return e;i.add(function(){return o.remove(i,t)})}else e&&(n=e.key);t&&t.key&&(n=t.key);var s=this.normalizeKeys(n);return this.indexKeys(s),s.forEach(function(e){o.loadingStacks.get(e).push(i||!0),o.updateLoadingStatus(e)}),e instanceof a.Observable?e:i},i.prototype.remove=function(e,t){var n,i,o=this;e instanceof a.Subscription?i=e:e instanceof Promise?i=e:e&&(n=e.key),t&&t.key&&(n=t.key),this.normalizeKeys(n).forEach(function(e){var t=o.loadingStacks.get(e);if(t){var n=t.indexOf(i||!0);0<=n&&(t.splice(n,1),o.updateLoadingStatus(e),o.deIndexKey(e))}})},i.prototype.normalizeKeys=function(e){return e?Array.isArray(e)||(e=[e]):e=[this.defaultKey],e},i.prototype.indexKeys=function(e){var i=this;e.forEach(function(e){if(i.loadingKeyIndex.has(e)){var t=i.loadingKeyIndex.get(e);i.loadingKeyIndex.set(e,t+1)}else{var n=new a.BehaviorSubject(!1);i.loadingKeyIndex.set(e,1),i.loadingSubjects.set(e,n),i.loadingStacks.set(e,[])}})},i.prototype.deIndexKey=function(e){var t=this.loadingKeyIndex.get(e);1===t?(this.loadingKeyIndex["delete"](e),this.loadingSubjects["delete"](e),this.loadingStacks["delete"](e)):this.loadingKeyIndex.set(e,t-1)},i.prototype.updateLoadingStatus=function(e){var t=0<this.loadingStacks.get(e).length;this.loadingSubjects.get(e).next(t)},i.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],i.ctorParameters=function(){return[]},i.ngInjectableDef=t.defineInjectable({factory:function(){return new i},token:i,providedIn:"root"}),i);function i(){this.defaultKey="default",this.loadingSubjects=new Map,this.loadingStacks=new Map,this.loadingKeyIndex=new Map}var o=(s.decorators=[{type:t.Component,args:[{selector:"sw-is-loading-spinner",template:"",host:{"class":"sw-is-loading-spinner"}}]}],s.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:t.ElementRef}]},s);function s(e,t){this.cdr=e,this.el=t,this.cdr.detach()}var l=new t.InjectionToken("SW_IS_LOADING_DIRECTIVE_CONFIG"),d=(Object.defineProperty(u.prototype,"swIsLoading",{set:function(e){"string"==typeof e?this.stringValue(e):this.notStringValue(),e instanceof a.Subscription?this.subscriptionValue(e):this.notSubscriptionValue(),e instanceof Promise?this.promiseValue(e):this.notPromiseValue(),"boolean"==typeof e?this.booleanValue(e):this.notBooleanValue(),e instanceof a.Observable?this.observableValue():this.notObservableValue()},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"swIsLoadingDisableEl",{get:function(){return this._swIsLoadingDisableEl},set:function(e){this._swIsLoadingDisableEl=c(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"swIsLoadingSpinner",{get:function(){return this._swIsLoadingSpinner},set:function(e){this._swIsLoadingSpinner=c(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"pending",{set:function(e){var t=this;this.startLoading(),e["finally"](function(){return t.stopLoading()})},enumerable:!0,configurable:!0}),u.prototype.ngOnChanges=function(e){!e.swIsLoadingSpinner||e.swIsLoadingSpinner.isFirstChange()||e.swIsLoadingSpinner.currentValue||this.removeSpinnerEl(),!e.swIsLoadingDisableEl||e.swIsLoadingDisableEl.isFirstChange()||e.swIsLoadingDisableEl.currentValue||this.renderer.removeAttribute(this.el.nativeElement,"disabled")},u.prototype.ngAfterViewInit=function(){this.swIsLoadingSpinner&&this.addSpinnerEl()},u.prototype.ngOnDestroy=function(){this.textValueSubscription&&this.textValueSubscription.unsubscribe()},u.prototype.startLoading=function(){this.renderer.addClass(this.el.nativeElement,this.loadingClass),this.swIsLoadingDisableEl&&this.renderer.setAttribute(this.el.nativeElement,"disabled","disabled"),this._isLoading=!0},u.prototype.stopLoading=function(){this.renderer.removeClass(this.el.nativeElement,this.loadingClass),this.swIsLoadingDisableEl&&this.renderer.removeAttribute(this.el.nativeElement,"disabled"),this._isLoading=!1},u.prototype.addSpinnerEl=function(){this.spinnerEl=this.componentFactoryResolver.resolveComponentFactory(o).create(this.injector),this.renderer.appendChild(this.el.nativeElement,this.spinnerEl.instance.el.nativeElement)},u.prototype.removeSpinnerEl=function(){this.spinnerEl&&(this.renderer.removeChild(this.el.nativeElement,this.spinnerEl.instance.el.nativeElement),this.spinnerEl.destroy(),this.spinnerEl=undefined)},u.prototype.stringValue=function(e){var t,n=this;this.textValueSubscription&&this.textValueSubscription.unsubscribe(),t=e?this.isLoadingService.isLoading$({key:e}):this.isLoadingService.isLoading$(),this.textValueSubscription=t.subscribe(function(e){e?n.startLoading():n.isLoading&&n.stopLoading()})},u.prototype.notStringValue=function(){this.textValueSubscription&&this.textValueSubscription.unsubscribe()},u.prototype.observableValue=function(){throw new TypeError("swBtnPending must be an instance of Subscription, instance of Observable given")},u.prototype.notObservableValue=function(){},u.prototype.subscriptionValue=function(t){this.pending=new Promise(function(e){return t.add(e)})},u.prototype.notSubscriptionValue=function(){},u.prototype.promiseValue=function(e){this.pending=e},u.prototype.notPromiseValue=function(){},u.prototype.booleanValue=function(e){var t=this;e?this.pending=new Promise(function(e){t.booleanValueResolveFn=e}):this.booleanValueResolveFn?this.booleanValueResolveFn():this.stopLoading()},u.prototype.notBooleanValue=function(){this.booleanValueResolveFn&&this.booleanValueResolveFn()},u.decorators=[{type:t.Directive,args:[{selector:"[swIsLoading]",exportAs:"swIsLoading"}]}],u.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Optional},{type:t.Inject,args:[l]}]},{type:t.Renderer2},{type:n},{type:t.ElementRef},{type:t.ComponentFactoryResolver},{type:t.Injector}]},u.propDecorators={swIsLoading:[{type:t.Input}],swIsLoadingDisableEl:[{type:t.Input}],swIsLoadingSpinner:[{type:t.Input}]},u);function u(e,t,n,i,o,s){this.renderer=t,this.isLoadingService=n,this.el=i,this.componentFactoryResolver=o,this.injector=s,this._isLoading=!1,this.config={},this._swIsLoadingDisableEl=this.config.disableEl===undefined||this.config.disableEl,this._swIsLoadingSpinner=this.config.addSpinnerEl!==undefined?this.config.addSpinnerEl:this.el.nativeElement instanceof HTMLButtonElement||this.el.nativeElement instanceof HTMLAnchorElement,this.loadingClass=this.config.loadingClass?this.config.loadingClass:"sw-is-loading",this.config=e||{}}function c(e){return"boolean"==typeof e?e:!!["","true"].includes(e)}var p=(g.decorators=[{type:t.NgModule,args:[{declarations:[d,o],entryComponents:[o],exports:[d]}]}],g);function g(){}var f=(h.prototype.transform=function(e){return this.isLoadingService.isLoading$({key:e})},h.decorators=[{type:t.Pipe,args:[{name:"swIsLoading"}]}],h.ctorParameters=function(){return[{type:n}]},h);function h(e){this.isLoadingService=e}var y=(b.decorators=[{type:t.NgModule,args:[{declarations:[f],exports:[f]}]}],b);function b(){}var v=(m.decorators=[{type:t.NgModule,args:[{imports:[p,y],providers:[],exports:[p,y]}]}],m);function m(){}e.IsLoadingService=n,e.IsLoadingModule=v,e.IsLoadingDirectiveModule=p,e.IsLoadingDirective=d,e.SW_IS_LOADING_DIRECTIVE_CONFIG=l,e.IsLoadingPipeModule=y,e.IsLoadingPipe=f,e.Éµa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=service-work-is-loading.umd.min.js.map